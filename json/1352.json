{"issue":{"title":"[CF 1352] Counter Conditions fails if watching multiple counter values ","body":" <p>I sent you some messages on curse about this a few days ago.</p>\r\n<p>&nbsp;</p>\r\n<p>Counter values work fine, but if trying to have the aura succeed on multiple counter values makes the aura succeed on every counter past the first one it is set to check. For example if the counter value was checking 2/4/6, it would succeed on everything past 2.</p>\r\n<p>&nbsp;</p>\r\n<p>Not sure if timer values are bugged this way.</p> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Jalopyy\">Jalopyy</a> | Imported from CurseForge issue <a href=\"https://wow.curseforge.com/projects/tellmewhen/issues/1352\">#1352</a> | <a href=\"https://github.com/tmw-issue-import/dump/blob/master/html/1352.html\">Raw</a>","closed":true,"closed_at":"2016-12-13T03:51:22Z","created_at":"2016-12-05T18:51:14Z","updated_at":"2016-12-13T23:18:59Z","labels":["defect","resolved"]},"comments":[{"body":" <p>Do add on to this, there are additional issues.</p>\r\n<p>&nbsp;</p>\r\n<p>1) If the counter is checking a combat condition, the condition will succeed on both the set value AND the value immediately after. IE, if it is set to 3, it'll ding on 3 and then briefly on 4. It does not have this kind of interaction if checking something like 'on condition passing'.</p>\r\n<p>2) For both 'condition set passing' and 'combat event, a counter cannot check multiple counter values in the same aura. You'd have to make separate auras to track multiple at once.</p> <div class=\"project-issue-comment-body-modified\"> <hr> <span class=\"e-infoLabel\">Edited</span><span> <abbr class=\"tip standard-date standard-datetime\" title=\"12 6 2016 19:42:23 (CST) (UTC-6:00)\" data-epoch=\"1481074943\">Dec 6, 2016</abbr></span> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Jalopyy\">Jalopyy</a>","created_at":"2016-12-07T01:41:40Z"},{"body":" <p>I need export strings of these things.</p> <div class=\"project-issue-comment-body-modified\"> <hr> <span class=\"e-infoLabel\">Edited</span><span> <abbr class=\"tip standard-date standard-datetime\" title=\"12 10 2016 13:15:22 (CST) (UTC-6:00)\" data-epoch=\"1481397322\">Dec 10, 2016</abbr></span> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2016-12-10T19:14:34Z"},{"body":" <p>I'll remake them in a bit.</p> <div class=\"project-issue-comment-body-modified\"> <hr> <span class=\"e-infoLabel\">Edited</span><span> <abbr class=\"tip standard-date standard-datetime\" title=\"12 10 2016 16:45:22 (CST) (UTC-6:00)\" data-epoch=\"1481409922\">Dec 10, 2016</abbr></span> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Jalopyy\">Jalopyy</a>","created_at":"2016-12-10T22:44:54Z"},{"body":" <p>Here's an example.</p>\r\n<p>&nbsp;</p>\r\n<p><a href=\"http://pastebin.com/mRAvHJE4\" rel=\"nofollow\">http://pastebin.com/mRAvHJE4</a> -&nbsp;Will succeed on 3, 4 (briefly), 5 and 6 (briefly).&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p>It seems to be working fine for 'condition set passing' counters, actually, Possibly because before I had multiple auras with the same counter name, possibly causing the addon to mix things up?</p>\r\n<p>&nbsp;</p>\r\n<p>If counter values do get messed up if multiple counters have the same name, perhaps making it so it disallows counters having the same name entirely.</p> <div class=\"project-issue-comment-body-modified\"> <hr> <span class=\"e-infoLabel\">Edited</span><span> <abbr class=\"tip standard-date standard-datetime\" title=\"12 10 2016 18:52:22 (CST) (UTC-6:00)\" data-epoch=\"1481417542\">Dec 10, 2016</abbr></span> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Jalopyy\">Jalopyy</a>","created_at":"2016-12-11T00:48:13Z"},{"body":" <p>The issue here is due to the order in which things happen when a combat event icon is triggered. The current order is as follows:</p>\r\n<p>&nbsp;</p>\r\n<ol>\r\n<li>All attributes from the event are set (start/duration time, source/dest units, the triggering spell, and the texture).</li>\r\n<li>A full icon update is performed, which evaluates any conditions on the icon and then calls the normal icon update function (which sets the icon's state - this is what governs the Opacity &amp; Color settings).</li>\r\n<li>Any On Combat Event triggers are triggered on the icon.</li>\r\n</ol>\r\n<p>Based on this process, here's what happens with this icon in particular on the 4th/6th casts if the icon was hidden when the cast happens:</p>\r\n<ol>\r\n<li>The combat event happens, setting the timer (and other stuff on the icon).</li>\r\n<li>The full icon update is performed, evaluating the condition on the icon (which is still passing because we haven't yet incremented the timer). The icon's state is updated as part of this, and because it is set to show while the timer is running, the icon shows.</li>\r\n<li>Because the icon has just shown, the sound triggers.</li>\r\n<li>The combat event notification is triggered, incrementing the counter.</li>\r\n<li>The icon's condition begins failing, causing the icon to hide.</li>\r\n</ol>\r\n<p>Since this all happens in the same update cycle (no frames drawn between the start and end), you never see the icon actually show, but it does indeed show behind the scenes.</p>\r\n<p>&nbsp;</p>\r\n<p>I'll make a change to the order in which things are processed, which should fix this - Combat Event triggers will now be processed before the full icon update, which will allow for any state overrides to be calculated before the icon's base state is calculated (conditions failing is a state override).</p>\r\n<p>The new process for this particular icon will now look like this:</p>\r\n<ol>\r\n<li>The combat event happens, setting the timer (and other stuff on the icon).</li>\r\n<li>The combat event notification is triggered, incrementing the counter.</li>\r\n<li>The icon's condition begins failing, causing <del>the icon to hide</del> nothing to happen since the icon was already hidden. However, the state override has now been set.</li>\r\n<li>The full icon update is performed, <del>evaluating the condition on the icon</del> and the condition won't be evaluated because nothing has changed since the previous evaluation that would prompt a reevaluation. The icon's state is updated as part of this, and because it is set to show while the timer is running, the icon's base state is set to show, but because we already set the override in step 3, the icon won't be shown and the sound won't trigger.</li>\r\n</ol> <div class=\"project-issue-comment-body-modified\"> <hr> <span class=\"e-infoLabel\">Edited</span><span> <abbr class=\"tip standard-date standard-datetime\" title=\"12 13 2016 17:18:59 (CST) (UTC-6:00)\" data-epoch=\"1481671139\">Dec 13, 2016</abbr></span> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2016-12-13T03:35:52Z"}]}