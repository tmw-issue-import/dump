{"issue":{"title":"[CF 856] OmniCC Timers Intermittently Break ","body":" <p><a href=\"http://i.imgur.com/0rX5pmu.jpg\" rel=\"nofollow\">http://i.imgur.com/0rX5pmu.jpg</a><br><a href=\"http://i.imgur.com/Gx5i7jO.jpg\" rel=\"nofollow\">http://i.imgur.com/Gx5i7jO.jpg</a></p><p>Kinda lost on this one. Sometimes they'll appear, sometimes they don't. No LUA errors that I can associate this with. This has been happening since the 6.2.5 version push. I'll go back to an older version now to confirm that timers work fine in those, and if so, might be something you tweaked in the latest version.</p> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Jalopyy\">Jalopyy</a> | Imported from CurseForge issue <a href=\"https://wow.curseforge.com/projects/tellmewhen/issues/856\">#856</a> | <a href=\"https://github.com/tmw-issue-import/dump/blob/master/html/856.html\">Raw</a>","closed":true,"closed_at":"2013-09-20T22:17:44Z","created_at":"2013-09-14T05:06:32Z","updated_at":"2013-09-20T22:17:44Z","labels":["defect","resolved"]},"comments":[{"body":" <p><a href=\"http://i.imgur.com/xqCjEpL.jpg\" rel=\"nofollow\">http://i.imgur.com/xqCjEpL.jpg</a></p>\r\n<p>This is what happens when I go back to 6.2.4. OmniCC timers work (the 'Show Timer Text' box), but obviously the ElvUI timers do not. I'll play with this some more to make sure they consistently stay, but I believe that will be the case, as I never had any troubles with this before 6.2.5.</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Freeebo\">Freeebo</a>","created_at":"2013-09-14T05:12:20Z"},{"body":" <p>I find it interesting that these two accounts are the same person.</p>\r\n<p>On point: The only change that was made between 6.2.4 and 6.2.5 was the addition of this code (which is the code that was suggested by Elv himself to remedy the timer issue):</p>\r\n<div><div><div>\n\n```\nif ElvUI and ElvUI[1].RegisterCooldown then\r\n\tElvUI[1]:RegisterCooldown(self.cooldown)\r\nend\r\n\n```\n</div></div>\r\n</div><p>If anything about this broke the OmniCC timers then it is entirely the fault of ElvUI, although I can't find anything in ElvUI's code (v6.47) to suggest that this is the case. I have just reopened the other ticket though because I just realized that ElvUI is now ignoring the option to disable its timers (the code that checked for that has been removed. I submitted a ticket to ElvUI so we will see if I have to put in a hacky fix or if it will be fixed on ElvUI's end of things.)</p>\r\n<p>Does this happen for other things (like your action bars or bags) if your enable OmniCC for them using the same OmniCC rule that you use for TMW?</p>\r\n<p>Also, what version of ElvUI are you using? <del>I ask because I find it strange that your icons don't have the ElvUI timer text on them because of the issue I described 2 paragraphs up.</del>\r\nNevermind - I suppose you disabled ElvUI's timer text entirely.</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2013-09-14T07:15:37Z"},{"body":" <p>I don't know why I had ever logged into that Plazzed account. Maybe I kinda forgot the info for this one when I cleared my cookies n' shit. Was it something I said that makes it funny about the correlation between those two accounts?</p>\r\n<p>The first two screenshots in the OP are with 6.2.5. The one posted after (on Freeebo) is with 6.2.4. Elv has been kinda on about not wanting elvui text to appear on other things to go away. I don't know why, since I've never seen or heard anyone complain about it, and it broke like 5 other things within ElvUI regarding timer text. Pointless crusade, really. Although maybe there was a reason that I just don't know of, which probably isn't an unlikely scenario.</p>\r\n<p>I'm using 6.49, the latest version of ElvUI. And yes, on the timers where I use OmniCC's text, I don't use ElvUI's. So it's not like they're trying to directly conflict or something, if that's what you're asking. For reference, in the screenshot I posted on my first comment to this, the Blood Fury icon (right side bars, the lower opacity orc icon w/a cooldown sweep) uses ElvUI's text, and as you can see does not show, whereas OmniCC does.</p> <div class=\"project-issue-comment-body-modified\"> <hr> <span class=\"e-infoLabel\">Edited</span><span> <abbr class=\"tip standard-date standard-datetime\" title=\"09 14 2013 03:55:32 (CDT) (UTC-5:00)\" data-epoch=\"1379148932\">Sep 14, 2013</abbr></span> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Freeebo\">Freeebo</a>","created_at":"2013-09-14T08:47:21Z"},{"body":" <p>Does this still happen when ElvUI is not enabled and loaded?</p>\r\n<p>Does this happen to other things that should be using OmniCC but won't?</p>\r\n<p>How often does this happen? Once every other reload? Once every 10 reloads? etc.?</p>\r\n<p>And I have to ask, just to be sure: Are you getting any Lua errors?</p> <div class=\"project-issue-comment-body-modified\"> <hr> <span class=\"e-infoLabel\">Edited</span><span> <abbr class=\"tip standard-date standard-datetime\" title=\"09 15 2013 12:59:16 (CDT) (UTC-5:00)\" data-epoch=\"1379267956\">Sep 15, 2013</abbr></span> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2013-09-15T17:58:53Z"},{"body":" <p>Timers work fine when ElvUI is not loaded. On another note, OmniCC timers are working fine w/ElvUI again. Like I said in the title, this is an intermittent issue and I can't really think of a \"trigger\" which breaks them. I'll keep 6.2.5 around until it breaks then update you when it does, along with anything that might be pertinent.</p>\r\n<p>Not that I can see. Everything besides timers were fine.</p>\r\n<p>I remember this happening on Timeless isle, so maybe somehow connected to the retarded input lag you get there? That sounds dumb though. I'll try going back there and seeing if I can force it to break.</p>\r\n<p>Definitely no LUA errors. Or at least nothing that shows up under Bugsack. I just turned on 'Display LUA Errors' but anything that pops up Bugsack should grab anyway.</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Freeebo\">Freeebo</a>","created_at":"2013-09-15T18:20:22Z"},{"body":" <p><a href=\"http://i.imgur.com/RTHkYe0.jpg\" rel=\"nofollow\">http://i.imgur.com/RTHkYe0.jpg</a></p>\r\n<p>This happened after I ticked off 'Show ElvUI timer' on a lot of icons (see the other ticket I just made). So possibly this issue has something to do with playing with timer options?</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Freeebo\">Freeebo</a>","created_at":"2013-09-16T02:27:23Z"},{"body":" <p>From what I can tell so as of late, reloading has fixed both of the recent issues I had with OmniCC text disappearing.</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Freeebo\">Freeebo</a>","created_at":"2013-09-18T10:07:56Z"},{"body":" <p>I really can't imagine that this issue is being caused by TellMeWhen. Since you have your timers located outside of your icons, it is clear that it isn't a frame level/Strata/layer issue where the timers are getting buried underneath the rest of the things shown on the icon. </p>\r\n<p>That said, I really can't imagine that this is an issue with omnicc either. I will see if I can write up some code that you can add as a code snippet to tmw that will give you a slash command you can use to get at some diagnostic information that you can give me when this issue happens again. I'm on my phone right now, but I will look into it when I get home. </p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2013-09-18T20:53:34Z"},{"body":" <p><a href=\"http://pastebin.com/smqC7Ae1\" rel=\"nofollow\">http://pastebin.com/smqC7Ae1</a></p>\r\n<p><a href=\"http://i.imgur.com/FLdX747.jpg\" rel=\"nofollow\">http://i.imgur.com/FLdX747.jpg</a> (non edited)\r\n<a href=\"http://i.imgur.com/b0lEKtC.jpg\" rel=\"nofollow\">http://i.imgur.com/b0lEKtC.jpg</a> (edited) </p>\r\n<p>If some of the text on the edited picture is too hard to see, ask me and I'll tell you what the # is. No color really stood out on everything.</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Freeebo\">Freeebo</a>","created_at":"2013-09-19T20:02:02Z"},{"body":" <p>Thanks. It looks like the timer isn't even being created. Next steps:</p>\r\n<p>When your timers are broken, do the following. Run this slash command:</p>\r\n<p><code>/run print(OmniCC:IsEventRegistered(\"VARIABLES_LOADED\"))</code></p>\r\n<p>and tell me what it prints to your chat. It will either be \"nil\" or \"1\". Then, do this:</p>\r\n<p><code>/run print(issecurevariable(getmetatable(ActionButton1Cooldown).__index, \"SetCooldown\"))</code></p>\r\n<p>and tell me what it prints. Then, do this:</p>\r\n<p><code>/run hooksecurefunc(OmniCC.Cooldown, \"CanShow\", function(cooldown, ...) icon = cooldown:GetParent() if icon == TMW[15][1] then print(icon, ...) end end)</code></p>\r\n<p>and go debuff something with colossus smash. TellMeWhat it prints to your chat. It might not print anything, especially if the first command outputted a 1. If it does print something, it will look like this: \"TellMeWhen_Group15_Icon1 358502.691 6.5 nil nil\"</p> <div class=\"project-issue-comment-body-modified\"> <hr> <span class=\"e-infoLabel\">Edited</span><span> <abbr class=\"tip standard-date standard-datetime\" title=\"09 19 2013 16:02:22 (CDT) (UTC-5:00)\" data-epoch=\"1379624542\">Sep 19, 2013</abbr></span> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2013-09-19T20:56:36Z"},{"body":" <p>Nil.</p>\r\n<p>No print, but <a href=\"http://pastebin.com/B3NrQcX3\" rel=\"nofollow\">http://pastebin.com/B3NrQcX3</a> LUA.</p>\r\n<p>No print.</p> <div class=\"project-issue-comment-body-modified\"> <hr> <span class=\"e-infoLabel\">Edited</span><span> <abbr class=\"tip standard-date standard-datetime\" title=\"09 19 2013 16:01:53 (CDT) (UTC-5:00)\" data-epoch=\"1379624513\">Sep 19, 2013</abbr></span> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Freeebo\">Freeebo</a>","created_at":"2013-09-19T21:00:04Z"},{"body":" <p>Sorry. Retry the second one ( i edited my post). CurseForge's formatting screwed it up.</p> <div class=\"project-issue-comment-body-modified\"> <hr> <span class=\"e-infoLabel\">Edited</span><span> <abbr class=\"tip standard-date standard-datetime\" title=\"09 19 2013 16:03:00 (CDT) (UTC-5:00)\" data-epoch=\"1379624580\">Sep 19, 2013</abbr></span> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2013-09-19T21:02:48Z"},{"body":" <p>Nil.</p>\r\n<p>1 nil.</p>\r\n<p>No print.</p>\r\n<p>If you want, put scripts in pastebin.</p>\r\n<p>E: So you know, G15 I1 is a meta icon. But I switched it with the icon it's checking and it still gave no readout. Dunno if it matters.</p> <div class=\"project-issue-comment-body-modified\"> <hr> <span class=\"e-infoLabel\">Edited</span><span> <abbr class=\"tip standard-date standard-datetime\" title=\"09 19 2013 16:06:36 (CDT) (UTC-5:00)\" data-epoch=\"1379624796\">Sep 19, 2013</abbr></span> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Freeebo\">Freeebo</a>","created_at":"2013-09-19T21:05:05Z"},{"body":" <p>Two more:</p>\r\n<p><code>/run print(rawget(TMW[15][1]:GetModuleOrModuleChild(\"IconModule_CooldownSweep\").cooldown, \"SetCooldown\"))</code></p>\r\n<p><code> /run print(issecurevariable(TMW[15][1]:GetModuleOrModuleChild(\"IconModule_CooldownSweep\").cooldown, \"SetCooldown\")) </code></p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2013-09-19T21:07:24Z"},{"body":" <p>function: 00000000308479E0</p>\r\n<p>1 nil</p> <div class=\"project-issue-comment-body-modified\"> <hr> <span class=\"e-infoLabel\">Edited</span><span> <abbr class=\"tip standard-date standard-datetime\" title=\"09 19 2013 16:09:41 (CDT) (UTC-5:00)\" data-epoch=\"1379624981\">Sep 19, 2013</abbr></span> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Freeebo\">Freeebo</a>","created_at":"2013-09-19T21:09:13Z"},{"body":" <p>At this point, I know the problem is ElvUI and I know where in ElvUI's code the problem is. What I don't know is why the problem seems to be random. I also don't know how to fix it without ripping ElvUI a new one. The problem is 100% caused by the new way that ElvUI does its timers that caused this whole headache in the first place. We have come full circle.</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2013-09-19T21:12:00Z"},{"body":" <p>Great job Elv.</p>\r\n<p>I think they pruned your ticket for the no.omnicc (or whatever) function's return, so I'm sure Elv just doesn't care. Suppose that leaves you wanting to make an ugly hackjob for it, or doing nothing (a simple /reload has fixed it for me every time).</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Freeebo\">Freeebo</a>","created_at":"2013-09-19T21:14:49Z"},{"body":" <p>He closed the ticket saying it will be fixed: <a href=\"http://www.tukui.org/tickets/elvui/index.php?page=bug_show&bug_id=363\" rel=\"nofollow\">http://www.tukui.org/tickets/elvui/index.php?page=bug_show&amp;bug_id=363</a></p>\r\n<p>It's too late for that, though, since I just did end up ripping ElvUI a new one. TellMeWhen now completely bypasses ElvUI's cooldown registration method and hooking process in favor of calling ElvUI's timer function directly when conditions are right (i.e. the setting to enable ElvUI's timer text is enabled and ElvUI's options also have the timer text enabled).</p>\r\n<p>This whole fiasco should be fixed in the next build, but CurseForge's packager is down right now. Go to <a href=\"https://github.com/ascott18/TellMeWhen/blob/master/Components/IconModules/IconModule_CooldownSweep/CooldownSweep.lua\" rel=\"nofollow\">https://github.com/ascott18/TellMeWhen/blob/master/Components/IconModules/IconModule_CooldownSweep/CooldownSweep.lua</a> and replace the contents of that file in your TellMeWhen installation with the contents of the file in that link.</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2013-09-19T21:27:26Z"},{"body":" <p>Ticket is closed but I take your word for it.</p>\r\n<p>And good to hear this will be fixed next build/with that link. Always grateful for the dedication you give to this addon. And if you want me to troubleshoot the memory leak problem, just tell me what to do.</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Freeebo\">Freeebo</a>","created_at":"2013-09-19T21:31:39Z"},{"body":" <p>I don't know where to begin on the memory leak issue. I suppose i will play around with your profile a bit and see if I can reproduce it, but if I can't then it is going to take some major brainstorming to figure out a way to determine what is causing it.</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2013-09-19T21:45:28Z"},{"body":" <p>Alright then. It only seems to happen on boss fights/raids. Not sure if it even happens in stuff like 5 mans.</p> <div class=\"project-issue-comment-body-modified\"> <hr> <span class=\"e-infoLabel\">Edited</span><span> <abbr class=\"tip standard-date standard-datetime\" title=\"09 19 2013 16:57:20 (CDT) (UTC-5:00)\" data-epoch=\"1379627840\">Sep 19, 2013</abbr></span> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Freeebo\">Freeebo</a>","created_at":"2013-09-19T21:56:47Z"},{"body":" <p>Did 6.2.5-3-g678b4d8 fix the timer issue for you?</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2013-09-20T17:24:45Z"},{"body":" <p>The one you just pushed? I already updated my Cooldownsweep.lua with the contents of the one you linked, and it hasn't broken since.</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Freeebo\">Freeebo</a>","created_at":"2013-09-20T18:40:19Z"}]}