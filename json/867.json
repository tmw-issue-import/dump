{"issue":{"title":"[CF 867] Frame drops when e.g. group composition changes ","body":" <p>This is the folllow-up ticket to my comment at curse.com (<a href=\"http://www.curse.com/addons/wow/tellmewhen#c4229\" rel=\"nofollow\">http://www.curse.com/addons/wow/tellmewhen#c4229</a>). Thanks for your reply.</p><p>I am and have been using TellMeWhen 6.2.6 (the default version including libraries); I wasn't sure I used it at the time I got the latest \"script ran too long\" error, but the version string is contained in the error message (<a href=\"http://paste.ubuntu.com/6167598/\" rel=\"nofollow\">http://paste.ubuntu.com/6167598/</a>).</p><p>I'm attaching the export string of my profile but most of the icons are specific to Feral Druids (I have all bars hidden and track all cooldowns using TMW). Others are attached to frames of other addons. Hopefully it will still be useful.</p><p>The text of my original comment:</p><p>I'm probably just using to many poorly set up icons, but I frequently have frame drops occur when - as far as I can see - new players become visible while I'm in a big raid group (new players joining an LFR group or engaging the opposing team in Isle of Conquest or Alterac Valley for the first time (I used BrokerCPU to find that TMWs CPU usage peaks at those moments).</p><p>Rather rarely, I also get a \"script ran too long\" error from some LibDogTag routine called by TMW (pastebin link). So I guess the two could be related.</p><p>What I'm getting to is that I actually don't use tags on any of my icons, so an option to globally disable the use of LibDogTag and any tags in TMW would be a nice feature.</p> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/meribold\">meribold</a> | Imported from CurseForge issue <a href=\"https://wow.curseforge.com/projects/tellmewhen/issues/867\">#867</a> | <a href=\"https://github.com/tmw-issue-import/dump/blob/master/html/867.html\">Raw</a>","closed":true,"closed_at":"2013-10-15T16:14:52Z","created_at":"2013-09-30T17:36:26Z","updated_at":"2013-10-15T16:14:52Z","labels":["defect","resolved"]},"comments":[{"body":"<strong>Attachment Added:</strong><a href=\"https://media.forgecdn.net/attachments/76/128/profile.txt\" target=\"_blank\"> profile.txt</a><br> <div class=\"attachment-desc\"> <h4 class=\"attachment-title\">profile.txt</h4> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/meribold\">meribold</a>","created_at":"2013-09-30T17:36:26Z"},{"body":" <p>I don't know if I'm getting these errors in pairs, but since both occurred thrice since the last time I cleared BugSack I'll post them here (the latter is the old \"script ran too long\" error I already posted).</p>\r\n<div><div><div>\n\n```\n3x invalid key to \"next\"\r\n&lt;in C code&gt;\r\nLib\\LibDogTag-Unit-3.0\\LibDogTag-Unit-3.0-90262.lua:49: in function &lt;Lib\\LibDogTag-Unit-3.0\\LibDogTag-Unit-3.0.lua:46&gt;\r\nLib\\LibDogTag-Unit-3.0\\LibDogTag-Unit-3.0-90262.lua:56: in function &lt;Lib\\LibDogTag-Unit-3.0\\LibDogTag-Unit-3.0.lua:55&gt;\r\n\r\nLocals:\r\nevent = \"UNIT_TARGETABLE_CHANGED\"\r\nunit = \"raid23\"\r\nwackyDependents = &lt;table&gt; {}\r\n(for generator) = &lt;func&gt; =[C]:-1\r\n(for state) = &lt;table&gt; {}\r\n(for control) = \"raid11target\"\r\nnormalUnitsWackyDependents = &lt;table&gt; {\r\n raid27 = &lt;table&gt; {}\r\n raid18 = &lt;table&gt; {}\r\n raid5 = &lt;table&gt; {}\r\n raid32 = &lt;table&gt; {}\r\n raid25 = &lt;table&gt; {}\r\n raid33 = &lt;table&gt; {}\r\n}\r\npairs = &lt;func&gt; =[C]:-1\r\nDogTag = &lt;table&gt; {\r\n unparse = &lt;func&gt; @TellMeWhen\\Lib\\..\\Parser.lua:1219\r\n select2 = &lt;func&gt; @TellMeWhen\\Lib\\..\\Helpers.lua:155\r\n callbackToFunction = &lt;table&gt; {}\r\n hasEvent = &lt;func&gt; @TellMeWhen\\Lib\\..\\Events.lua:159\r\n IterateFactions = &lt;func&gt; @TellMeWhen\\Lib\\LibDogTag-Unit-3.0\\Categories\\Reputation.lua:47\r\n callbackToExtraArg = &lt;table&gt; {}\r\n __colors = &lt;table&gt; {}\r\n Tags = &lt;table&gt; {}\r\n CleanCode = &lt;func&gt; @TellMeWhen\\Lib\\..\\Parser.lua:1581\r\n codeToFunction = &lt;table&gt; {}\r\n newDict = &lt;func&gt; @TellMeWhen\\Lib\\..\\Helpers.lua:35\r\n clearCodes = &lt;func&gt; @TellMeWhen\\Lib\\..\\Helpers.lua:515\r\n TimerHandlers = &lt;table&gt; {}\r\n ADDON_LOADED = &lt;func&gt; @TellMeWhen\\Lib\\..\\LibDogTag-3.0.lua:515\r\n AddCallback = &lt;func&gt; @TellMeWhen\\Lib\\..\\Events.lua:193\r\n RemoveCompilationStep = &lt;func&gt; @TellMeWhen\\Lib\\..\\Compiler.lua:2259\r\n _clearCodes = &lt;func&gt; @TellMeWhen\\Lib\\..\\Helpers.lua:441\r\n deepCompare = &lt;func&gt; @TellMeWhen\\Lib\\..\\Helpers.lua:335\r\n RemoveEventHandler = &lt;func&gt; @TellMeWhen\\Lib\\..\\Events.lua:730\r\n newSet = &lt;func&gt; @TellMeWhen\\Lib\\..\\Helpers.lua:51\r\n __mytonumber = &lt;func&gt; @TellMeWhen\\Lib\\..\\Compiler.lua:292\r\n OpenHelp = &lt;func&gt; @TellMeWhen\\Lib\\..\\Help.lua:25\r\n EventHandlers = &lt;table&gt; {}\r\n RemoveCallback = &lt;func&gt; @TellMeWhen\\Lib\\..\\Events.lua:238\r\n parse = &lt;func&gt; @TellMeWhen\\Lib\\..\\Parser.lua:1043\r\n frame = &lt;unnamed&gt; {}\r\n fixNamespaceList = &lt;table&gt; {}\r\n fsToFrame = &lt;table&gt; {}\r\n compilationSteps = &lt;table&gt; {}\r\n AddTag = &lt;func&gt; @TellMeWhen\\Lib\\..\\LibDogTag-3.0.lua:126\r\n AddCompilationStep = &lt;func&gt; @TellMeWhen\\Lib\\..\\Compiler.lua:2232\r\n kwargsToKwargTypes = &lt;table&gt; {}\r\n __lastMouseover = LibDBIcon10_BugSack {}\r\n UpdateFontString = &lt;func&gt; @TellMeWhen\\Lib\\..\\LibDogTag-3.0.lua:327\r\n AddEventHandler = &lt;func&gt; @TellMeWhen\\Lib\\..\\Events.lua:700\r\n IsNormalUnit = &lt;table&gt; {}\r\n standardize = &lt;func&gt; @TellMeWhen\\Lib\\..\\Parser.lua:1063\r\n RemoveAllCompilationSteps = &lt;func&gt; @TellMeWhen\\Lib\\..\\Compiler.lua:2286\r\n IsLegitimateUnit = &lt;table&gt; {}\r\n UnitToLocale = &lt;table&gt; {}\r\n getTagData = &lt;func&gt; @TellMeWhen\\Lib\\..\\Compiler.lua:247\r\n ColorizeCode = &lt;func&gt; @TellMeWhen\\Lib\\..\\Parser.lua:1656\r\n memoizeTable = &lt;func&gt; @TellMeWhen\\Lib\\..\\Helpers.lua:315\r\n RemoveFontString = &lt;func&gt; @TellMeWhen\\Lib\\..\\LibDogTag-3.0.lua:448\r\n joinSet = &lt;func&gt; @TellMeWhen\\Lib\\..\\Helpers.lua:162\r\n RemoveTimerHandler = &lt;func&gt; @TellMeWhen\\Lib\\..\\Events.lua:819\r\n Evaluate = &lt;func&gt; @TellMeWhen\\Lib\\..\\Compiler.lua:2198\r\n sortStringList = &lt;func&gt; @TellMeWhen\\Lib\\..\\Helpers.lua:138\r\n AddTimerHandler\r\n\n```\n</div></div>\r\n</div><div><div><div>\n\n```\n3x Lib\\LibDogTag-Unit-3.0\\LibDogTag-Unit-3.0-90262.lua:221: script ran too long\r\nLib\\LibDogTag-Unit-3.0\\LibDogTag-Unit-3.0-90262.lua:221: in function &lt;Lib\\LibDogTag-Unit-3.0\\LibDogTag-Unit-3.0.lua:220&gt;\r\nLib\\LibDogTag-Unit-3.0\\LibDogTag-Unit-3.0-90262.lua:274: in function &lt;Lib\\LibDogTag-Unit-3.0\\LibDogTag-Unit-3.0.lua:246&gt;\r\nLib\\LibDogTag-Unit-3.0\\LibDogTag-Unit-3.0-90262.lua:462: in function \"func\"\r\nTellMeWhen-6.2.6\\Lib\\22LibDogTag-3.0-90203\\Events.lua:271: in function &lt;TellMeWhen\\Lib\\LibDogTag-3.0\\Events.lua:264&gt;\r\nTellMeWhen-6.2.6\\Lib\\22LibDogTag-3.0-90203\\Events.lua:767: in function \"FireEvent\"\r\nLib\\LibDogTag-Unit-3.0\\LibDogTag-Unit-3.0-90262.lua:50: in function &lt;Lib\\LibDogTag-Unit-3.0\\LibDogTag-Unit-3.0.lua:46&gt;\r\nLib\\LibDogTag-Unit-3.0\\LibDogTag-Unit-3.0-90262.lua:56: in function &lt;Lib\\LibDogTag-Unit-3.0\\LibDogTag-Unit-3.0.lua:55&gt;\r\n\r\nLocals:\r\nunit = \"raid15pettarget\"\r\nguid = nil\r\noldGuid = \"0xF1310D2900000064\"\r\n(for generator) = &lt;func&gt; =[C]:-1\r\n(for state) = &lt;table&gt; {\r\n raid2pettarget = true\r\n raid26pet = true\r\n raid1pettarget = true\r\n raid15target = true\r\n raidpet6 = true\r\n raid22pet = true\r\n raid26target = true\r\n raid6pettarget = true\r\n raid2pet = true\r\n raid10target = true\r\n raidpet31target = true\r\n arena4pettarget = true\r\n raidpet32 = true\r\n raid16pet = true\r\n raid20pet = true\r\n raidpet5target = true\r\n playerpettargettarget = true\r\n raid34pettarget = true\r\n raid15pet = true\r\n raid32pettarget = true\r\n raidpet34 = true\r\n raid30pet = true\r\n raid29pettarget = true\r\n arenapet1target = true\r\n raid33pettarget = true\r\n raidpet39 = true\r\n arena5target = true\r\n arena5pettargettarget = true\r\n raid4target = true\r\n arenapet4target = true\r\n raidpet2target = true\r\n raid25pet = true\r\n arenapet5target = true\r\n party1pettarget = true\r\n raidpet10target = true\r\n partypet3targettarget = true\r\n raid40pet = true\r\n raid20pettarget = true\r\n raidpet18target = true\r\n raidpet29 = true\r\n raidpet40 = true\r\n raidpet16 = true\r\n raidpet29target = true\r\n raidpet35target = true\r\n raid39pet = true\r\n raid24pettarget = true\r\n raidpet19 = true\r\n raidpet11target = true\r\n raid7pettarget = true\r\n raid17pettarget = true\r\n party2targettarget = true\r\n raidpet24target = true\r\n raid11target = true\r\n pettarget = true\r\n partypet2targettarget = true\r\n raidpet33target = true\r\n arena1pettargettarget = true\r\n raid25pettarget = true\r\n raid30pettarget = true\r\n raid38target = true\r\n raidpet27 = true\r\n raid18target = true\r\n raid16pettarget = true\r\n boss2targettarget = true\r\n arena3pettargettarget = true\r\n raidpet13 = true\r\n raid39target = true\r\n partypet2target = true\r\n raid19pet = true\r\n raid23target = true\r\n party1pettargettarget = true\r\n raid20target = true\r\n raid3pettarget = true\r\n raid10pet = true\r\n raid6pet = true\r\n raid11pettarget = true\r\n raid28target = true\r\n raid36pettarget = true\r\n arena3target = true\r\n raidpet4target = true\r\n raidpet24 = true\r\n party3target = true\r\n raid25target = true\r\n arenapet3target = true\r\n boss4target = true\r\n playertargettargettarget = true\r\n raid23pettarget = true\r\n raid4pet = true\r\n raid8pet = true\r\n arena2target = true\r\n arena1targettarget = true\r\n raidpet32target = true\r\n raid21pet = true\r\n raidpet21 = true\r\n raid26pettarget = true\r\n raid19pettarget = true\r\n boss3targettarget = true\r\n raid35pettarget = true\r\n raid8pettarget = true\r\n raidpet14target = true\r\n raid28pet = true\r\n arena2pettargettarget = true\r\n pettargettarget = true\r\n raid15pettarget = true\r\n raidpet37target = true\r\n raid32target = true\r\n raidpet1 = true\r\n playerpettarget = true\r\n raid9pettarget = true\r\n party1targettarget = true\r\n raid31pet = true\r\n raidpet12target = true\r\n raidpet15target = true\r\n arena4targettarget = true\r\n raid12pet = true\r\n arena5pettarget = true\r\n arenapet1targettarget = true\r\n raidpet33 = true\r\n raidpet26 = true\r\n targettargettarget = true\r\n party2target = true\r\n party3pettarget = true\r\n raidpet15 = true\r\n raid36target = true\r\n raidpet25 = true\r\n raidpet35 = true\r\n raidpet10 = true\r\n raid30target = true\r\n raid40pettarget = true\r\n raid5target = true\r\n arenapet3targettarget = true\r\n raid11pet = true\r\n raid32pet = true\r\n raid37target = true\r\n raidpet1target = true\r\n raidpet27target = true\r\n partypet4target = true\r\n raidpet36 = true\r\n boss5target = true\r\n party2pettargettarget = true\r\n raidpet14 = true\r\n raid31target = true\r\n raid23pet = true\r\n raid1target = true\r\n raid35pet = true\r\n raid38pettarget = true\r\n raid21target = true\r\n raidpet6target = true\r\n raid10pettarget = true\r\n raidpet22 = true\r\n boss1target = true\r\n raid22target = true\r\n raidpet9target = true\r\n raidpet22target = true\r\n boss1targettarget = true\r\n raidpet3target = true\r\n raidpet20target = true\r\n raidpet30 = true\r\n raid24pet = true\r\n raid5pet = true\r\n arenapet4targettarget = true\r\n raid28pettarget = true\r\n raid7target = true\r\n raid18pettarget = true\r\n raid36pet = true\r\n raidpet19target = true\r\n raidpet38 = true\r\n raidpet7target = true\r\n raid14target = true\r\n raid9target = true\r\n party4pettarget = true\r\n arena5targettarget = true\r\n raid17target = true\r\n arena4pettargettarget = true\r\n raid34target = true\r\n arena4target = true\r\n arena3targettarget = true\r\n arena3pettarget = true\r\n raid22pettarg\r\n\n```\n</div></div>\r\n</div> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/meribold\">meribold</a>","created_at":"2013-10-03T02:37:45Z"},{"body":" <p>I have attempted a fix in LibDogTag-Unit-3.0 r263 - you can download it from <a href=\"http://www.wowace.com/addons/libdogtag-unit-3-0/files/\" rel=\"nofollow\">http://www.wowace.com/addons/libdogtag-unit-3-0/files/</a> whenever the packager gets around to packaging it.</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2013-10-04T02:34:49Z"},{"body":" <p>I replaced TellMeWhen\\Lib\\LibDogTag-Unit-3.0 with the new version.</p>\r\n<p>I didn't get any more errors but the frame drops aren't gone entirely. I'll try to get a bit of a better idea when they occur and what icons they relate to.</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/meribold\">meribold</a>","created_at":"2013-10-05T18:21:37Z"},{"body":" <p>I can reproduce the issue by creating a new profile and pulling about 40 skills from my spell book into TMW's icon slots.</p>\r\n<p>When I fly through the main gate of Stormwind with that profile, the CPU time of TMW increases by about 0.2 to 0.3 seconds as the players in the zone I'm leaving phase out and the other players phase in (at 6:00 am; so there's not a lot going on).</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/meribold\">meribold</a>","created_at":"2013-10-06T04:44:14Z"},{"body":" <p>It has been a long time coming, but give v7.0.0 a shot: <a href=\"http://wow.curseforge.com/addons/tellmewhen/files/1520-6-2-6-163-g3661d78/\" rel=\"nofollow\">http://wow.curseforge.com/addons/tellmewhen/files/1520-6-2-6-163-g3661d78/</a></p>\r\n<p>I think I did some optimizations along the way at some point that should reduce the problems that you are seeing.</p>\r\n<p>On a somewhat related, but inconsequential, note, the last commit that was made before I merged 7.0.0's development branch into the master branch was the 1000th commit that has been made to TMW. That's pretty neat.</p> <div class=\"project-issue-comment-body-modified\"> <hr> <span class=\"e-infoLabel\">Edited</span><span> <abbr class=\"tip standard-date standard-datetime\" title=\"10 13 2013 01:44:53 (CST) (UTC-5:00)\" data-epoch=\"1381646693\">Oct 13, 2013</abbr></span> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2013-10-13T06:44:35Z"},{"body":" <p>Awesome! New major version. And thanks for the clarification about and new option for DR durations.</p>\r\n<p>The load spikes are down to about 50% (still noticeable with my &gt;100 icons but definitely better) </p>\r\n<p><a href=\"http://youtu.be/ZW3ibFxDOaI\" rel=\"nofollow\">http://youtu.be/ZW3ibFxDOaI</a> if you want to take a look at my excessive use of your addon <span>:)</span></p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/meribold\">meribold</a>","created_at":"2013-10-13T19:28:11Z"},{"body":" <p>That is about as good as things are going to get if you have that many icons. Keep in mind that addon CPU usage is greatly increased when you have CPU profiling enabled - disable it and you will see far less noticable spikes.</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2013-10-15T16:12:22Z"}]}