{"issue":{"title":"[CF 1280] Add a way to track damage taken over 5 seconds ","body":" <p>For frenzied regen &amp; death strike. Possibly other things too.</p> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a> | Imported from CurseForge issue <a href=\"https://wow.curseforge.com/projects/tellmewhen/issues/1280\">#1280</a> | <a href=\"https://github.com/tmw-issue-import/dump/blob/master/html/1280.html\">Raw</a>","closed":true,"closed_at":"2016-11-26T21:32:53Z","created_at":"2016-08-20T02:07:53Z","updated_at":"2018-09-22T02:31:19Z","labels":["enhancement","declined"]},"comments":[{"body":" <p>Has this been implemented yet?</p>\r\n<p>Looking for a way to track Frenzied Regen.</p>\r\n<p>Cheers!</p> <div class=\"project-issue-comment-body-modified\"> <hr> <span class=\"e-infoLabel\">Edited</span><span> <abbr class=\"tip standard-date standard-datetime\" title=\"10 16 2016 02:41:45 (CST) (UTC-5:00)\" data-epoch=\"1476603705\">Oct 16, 2016</abbr></span> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Idn0\">Idn0</a>","created_at":"2016-10-15T07:19:20Z"},{"body":" <p><cite>@<a href=\"https://github.com/tmw-issue-import/TellMeWhen/issues?q=%5BCF%201280%5D+in%3Atitle\" rel=\"nofollow\">Idn0</a>: <a href=\"https://github.com/tmw-issue-import/TellMeWhen/issues?q=%5BCF%201280%5D+in%3Atitle\" rel=\"nofollow\">Go</a></cite></p>\r\n<p>Would also really like this feature. Tried looking through it myself and through old Blood DK (Death Strike heal) and Resolve/Vengeance ones but I couldn't seem to find anything I could work with- I guess everyone just used the old Blood Shield Tracker addon.</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/ash1k1\">ash1k1</a>","created_at":"2016-10-16T07:43:43Z"},{"body":" <p>Here's an icon for Frenzied Regen: <a href=\"https://wow.curseforge.com/addons/tellmewhen/forum/druid/130177-frenzied-regeneration/#p2\" rel=\"nofollow\">https://wow.curseforge.com/addons/tellmewhen/forum/druid/130177-frenzied-regeneration/#p2</a></p>\r\n<p>I've decided not to implement this behavior into TMW directly, because its just one more thing that I would have to keep track of and keep maintained through each expansion, and there are a lot more intricacies than just damage over last 5 seconds.</p>\r\n<p>If someone can find a weakaura or something similar that will track the death strike heal, i'll make it into a TMW icon.</p> <div class=\"project-issue-comment-body-modified\"> <hr> <span class=\"e-infoLabel\">Edited</span><span> <abbr class=\"tip standard-date standard-datetime\" title=\"11 5 2016 16:32:58 (CST) (UTC-5:00)\" data-epoch=\"1478381578\">Nov 5, 2016</abbr></span> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2016-11-05T21:32:34Z"},{"body":" <p>Thanks for the reply @Cybeloras, though it seems the forums have changed since I last visited (woops!) - is there any chance you could point me in the direction of where/what that link was? I can't seem to find anything regarding the Death Strike heal as I mentioned last time, I think most used BST instead.</p> <div class=\"project-issue-comment-body-modified\"> <hr> <span class=\"e-infoLabel\">Edited</span><span> <abbr class=\"tip standard-date standard-datetime\" title=\"11 25 2016 05:08:21 (CST) (UTC-6:00)\" data-epoch=\"1480072101\">Nov 25, 2016</abbr></span> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/ash1k1\">ash1k1</a>","created_at":"2016-11-25T11:08:09Z"},{"body":" <p><a href=\"https://www.curseforge.com/forums/wow-sites/wow-sites-feedback/127024-no-more-project-forums#c11\" rel=\"nofollow\">https://www.curseforge.com/forums/wow-sites/wow-sites-feedback/127024-no-more-project-forums#c11</a> Curse got rid of the forums. If you'd like to share what you think of this decision with them, you can add your thoughts to this thread that is at the beginning of this comment because copy paste is broken on mobile on the new site and will only paste at the beginning.</p>\r\n<p>&nbsp;</p> <div class=\"project-issue-comment-body-modified\"> <hr> <span class=\"e-infoLabel\">Edited</span><span> <abbr class=\"tip standard-date standard-datetime\" title=\"11 26 2016 02:22:21 (CST) (UTC-6:00)\" data-epoch=\"1480148541\">Nov 26, 2016</abbr></span> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2016-11-26T08:22:03Z"},{"body":" <p>Here's the export string of the FR icon in the mean time, since I found that I still have it:</p>\r\n<p>&nbsp;</p>\r\n<div>\n\n```\n^1^T^SType^Scooldown ^SName^SFrenzied~`Regeneration ^SEnabled^B ^SEvents^T ^N1^T ^SType^SLua ^SLua^S--~`Frenzied~`Regen~`by~`Hamsda~`of~`Mannoroth-EU~`and~`Yumari~`of~`TheMaelstrom-EU~J --~`Adapted~`from~`the~`WeakAura~`at~`https://wago.io/NkogH0_D-~J ~J local~`icon~`=~`...~J ~J if~`TMW.hasInitFR~`then~`return~`end~J TMW.hasInitFR~`=~`true~J icon.aura_env~`=~`{}~J local~`aura_env~`=~`icon.aura_env~J LibStub(\"AceEvent-3.0\"):Embed(aura_env)~J ~J aura_env.showAbsolute~`=~`false~`--set~`to~`true~`to~`show~`absolute~`heal~`value~`instead~`of~`percentage~J ~J aura_env.lastSec~`=~`5~J aura_env.percDmg~`=~`0.5~J aura_env.minHealthPerc~`=~`0.05~J ~J aura_env.table~`=~`{}~J ~J --set~`bonuses~J aura_env.GetNumSetPieces~`=~`function(set,~`class)~`~J ~`~`~`~`class~`=~`class~`or~`select(2,~`UnitClass(\"player\"))~J ~`~`~`~`local~`pieces~`=~`aura_env.sets[class][set]~`or~`{}~J ~`~`~`~`local~`counter~`=~`0~J ~`~`~`~`for~`_,~`itemID~`in~`ipairs(pieces)~`do~J ~`~`~`~`~`~`~`~`if~`IsEquippedItem(itemID)~`then~J ~`~`~`~`~`~`~`~`~`~`~`~`counter~`=~`counter~`+~`1~J ~`~`~`~`~`~`~`~`end~J ~`~`~`~`end~J ~`~`~`~`return~`counter~J end~J ~J aura_env.sets~`=~`{~J ~`~`~`~`[\"DRUID\"]~`=~`{~J ~`~`~`~`~`~`~`~`[\"T18\"]~`=~`{~J ~`~`~`~`~`~`~`~`~`~`~`~`124246,~J ~`~`~`~`~`~`~`~`~`~`~`~`124255,~J ~`~`~`~`~`~`~`~`~`~`~`~`124261,~J ~`~`~`~`~`~`~`~`~`~`~`~`124267,~J ~`~`~`~`~`~`~`~`~`~`~`~`124272,~J ~`~`~`~`~`~`~`~`},~J ~`~`~`~`},~J }~J ~J ~J aura_env.text~`=~`function(...)~J ~`~`~`~`local~`i~`=~`1~J ~`~`~`~`local~`cur~`=~`GetTime()~J ~`~`~`~`local~`total~`=~`0~J ~`~`~`~`~J ~`~`~`~`--get~`total~`damage~`taken~J ~`~`~`~`while~`aura_env.table[i]~`do~J ~`~`~`~`~`~`~`~`--grab~`table~`entries~`with~`time~`and~`damage~J ~`~`~`~`~`~`~`~`local~`time~`=~`aura_env.table[i][1]~J ~`~`~`~`~`~`~`~`local~`dmg~`=~`aura_env.table[i][2]~J ~`~`~`~`~`~`~`~`~J ~`~`~`~`~`~`~`~`--if~`the~`damage~`happened~`outside~`of~`the~`timewindow~J ~`~`~`~`~`~`~`~`if~`cur~`&gt;~`time~`+~`aura_env.lastSec~`then~J ~`~`~`~`~`~`~`~`~`~`~`~`--remove~`the~`entry~J ~`~`~`~`~`~`~`~`~`~`~`~`table.remove(aura_env.table,~`i)~J ~`~`~`~`~`~`~`~`else~`--otherwise~J ~`~`~`~`~`~`~`~`~`~`~`~`--add~`up~`the~`damage~`and~`go~`to~`next~`entry~J ~`~`~`~`~`~`~`~`~`~`~`~`total~`=~`total~`+~`dmg~J ~`~`~`~`~`~`~`~`~`~`~`~`i~`=~`i~`+~`1~J ~`~`~`~`~`~`~`~`end~J ~`~`~`~`end~J ~`~`~`~`~J ~`~`~`~`--Mastery~J ~`~`~`~`local~`mastery~`=~`1~`+~`GetMastery()~`/~`200~J ~`~`~`~`~J ~`~`~`~`--Versatility~J ~`~`~`~`local~`vers~`=~`1~`+~`((GetCombatRatingBonus(29)~`+~`GetVersatilityBonus(30))~`/~`100)~J ~`~`~`~`~J ~`~`~`~`--Leech~J ~`~`~`~`local~`leech~`=~`1~`+~`GetLifesteal()~`/~`100~J ~`~`~`~`~J ~`~`~`~`--Guardian~`of~`Elune~J ~`~`~`~`local~`goe~`=~`((select(4,~`GetTalentInfo(6,2,1)))~`and~`UnitBuff(\"player\",~`GetSpellInfo(213680)))~`and~`1.2~`or~`1~J ~`~`~`~`~J ~`~`~`~`--check~`artifact~`traits~J ~`~`~`~`local~`currentRank~`=~`0~J ~`~`~`~`local~`loaded~`=~`IsAddOnLoaded(\"LibArtifactData-1.0\")~`or~`LoadAddOn(\"LibArtifactData-1.0\")~J ~`~`~`~`if~`loaded~`then~J ~`~`~`~`~`~`~`~`aura_env.LAD~`=~`aura_env.LAD~`or~`LibStub(\"LibArtifactData-1.0\")~J ~`~`~`~`~`~`~`~`if~`not~`aura_env.LAD:GetActiveArtifactID()~`then~J ~`~`~`~`~`~`~`~`~`~`~`~`aura_env.LAD:ForceUpdate()~`~`~`~`~`~`~`~`~`~`~`~`~J ~`~`~`~`~`~`~`~`end~J ~`~`~`~`~`~`~`~`local~`_,~`traits~`=~`aura_env.LAD:GetArtifactTraits()~J ~`~`~`~`~`~`~`~`if~`traits~`then~J ~`~`~`~`~`~`~`~`~`~`~`~`for~`_,v~`in~`ipairs(traits)~`do~J ~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`if~`v.spellID~`==~`200400~`then~J ~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`currentRank~`=~`v.currentRank~J ~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`break~J ~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`end~J ~`~`~`~`~`~`~`~`~`~`~`~`end~J ~`~`~`~`~`~`~`~`end~J ~`~`~`~`end~J ~`~`~`~`local~`trait~`=~`1~`+~`0.05~`*~`currentRank~J ~`~`~`~`~J ~`~`~`~`--Guardian~`Spirit~J ~`~`~`~`local~`gs~`=~`UnitBuff(\"player\",~`GetSpellInfo(47788))~`and~`1.4~`or~`1~J ~`~`~`~`~J ~`~`~`~`--Divine~`Hymn~J ~`~`~`~`local~`dh~`=~`UnitBuff(\"player\",~`GetSpellInfo(64844))~`and~`1.1~`or~`1~J ~`~`~`~`~J ~`~`~`~`--Life~`Cocoon~J ~`~`~`~`local~`lc~`=~`UnitBuff(\"player\",~`GetSpellInfo(116849))~`and~`1.5~`or~`1~J ~`~`~`~`~J ~`~`~`~`--T17~J ~`~`~`~`local~`t17~`=~`1~J ~`~`~`~`local~`t17n,~`_,~`_,~`t17s~`=~`UnitBuff(\"player\",~`GetSpellInfo(177969))~J ~`~`~`~`if~`t17n~`then~J ~`~`~`~`~`~`~`~`t17~`=~`1~`+~`t17s~`*~`0.1~J ~`~`~`~`end~J ~`~`~`~`~J ~`~`~`~`--T18~J ~`~`~`~`local~`t18~`=~`UnitBuff(\"player\",~`GetSpellInfo(192081))~`and~`aura_env.GetNumSetPieces(\"T18\")~`&gt;=~`2~`and~`1.2~`or~`1~J ~`~`~`~`~J ~`~`~`~`--T19~J ~`~`~`~`local~`t19~`=~`1~J ~`~`~`~`local~`t19n,~`_,~`_,~`t19s~`=~`UnitBuff(\"player\",~`GetSpellInfo(211160))~J ~`~`~`~`if~`t19n~`then~J ~`~`~`~`~`~`~`~`t19~`=~`1~`+~`(t19s~`/~`3)~J ~`~`~`~`end~J ~`~`~`~`~J ~`~`~`~`--Skysec's~`Hold~J ~`~`~`~`local~`leg~`=~`IsEquippedItem(137025)~`and~`0.100078~`or~`0~`--restores~`~|10%~`of~`mastery~`affected~`maxhp~J ~`~`~`~`if~`leg~`&gt;~`0~`then~J ~`~`~`~`~`~`~`~`--but~`the~`buff~`doesn't~`roll~`over~`like~`FR,~`so~`loses~`value~`if~`uses~`twice~`in~`quick~`succession~J ~`~`~`~`~`~`~`~`local~`exp~`=~`select(7,~`UnitBuff(\"player\",~`GetSpellInfo(208218)))~`or~`GetTime()~J ~`~`~`~`~`~`~`~`local~`rem~`=~`exp~`-~`GetTime()~J ~`~`~`~`~`~`~`~`if~`rem~`&gt;~`2~`then~J ~`~`~`~`~`~`~`~`~`~`~`~`leg~`=~`leg~`*~`1~`/~`3~J ~`~`~`~`~`~`~`~`elseif~`rem~`&gt;~`1~`then~J ~`~`~`~`~`~`~`~`~`~`~`~`leg~`=~`leg~`*~`2~`/~`3~J ~`~`~`~`~`~`~`~`end~J ~`~`~`~`end~J ~`~`~`~`~J ~`~`~`~`~J ~`~`~`~`local~`heal~`=~`total~`*~`aura_env.percDmg~`--damage~`taken~`*~`FR~`percentage~J ~`~`~`~`local~`perc~`=~`heal~`/~`UnitHealthMax(\"player\")~`--relative~`to~`maxHP~J ~`~`~`~`perc~`=~`math.max(aura_env.minHealthPerc,~`perc)~`--minimum~`FR~`percentage~J ~`~`~`~`perc~`=~`(perc~`*~`goe~`*~`trait~`*~`t17~`*~`t18~`*~`t19~`*~`vers~`+~`leg)~`*~`mastery~`*~`leech~`*~`gs~`*~`dh~`*~`lc~`--apply~`all~`multipliers~J ~`~`~`~`heal~`=~`perc~`*~`UnitHealthMax(\"player\")~`--get~`the~`actual~`heal~`value~J ~`~`~`~`~J ~`~`~`~`return~`heal~J end~J ~J TMW.C.IconComponent:RegisterDogTag(\"TMW\",~`\"FrenziedRegen\",~`{~J ~`~`~`~`~`~`~`~`code~`=~`aura_env.text,~J ~`~`~`~`~`~`~`~`events~`=~`\"FastUpdate\",~J ~`~`~`~`~`~`~`~`ret~`=~`\"string\",~J ~`~`~`~`~`~`~`~`doc~`=~`\"Returns~`the~`predicted~`heal~`amount~`from~`Frenzied~`Regeneration\",~J ~`~`~`~`~`~`~`~`example~`=~`'[FrenziedRegen]~`=&gt;~`\"326137\"',~J ~`~`~`~`~`~`~`~`category~`=~`\"Custom\",~J })~J ~J function~`aura_env:COMBAT_LOG_EVENT_UNFILTERED(event,~`time,~`subevent,~`...)~J ~`~`~`~`if~`select(6,~`...)~`==~`UnitGUID(\"player\")~`then~J ~`~`~`~`~`~`~`~`~J ~`~`~`~`~`~`~`~`--set~`selection~`offset~`to~`amount~`for~`baseline~`SWING_DAMAGE~J ~`~`~`~`~`~`~`~`local~`offset~`=~`10~J ~`~`~`~`~`~`~`~`~J ~`~`~`~`~`~`~`~`--handle~`SPELL_ABSORBED~`events~J ~`~`~`~`~`~`~`~`if~`subevent~`==~`\"SPELL_ABSORBED\"~`then~J ~`~`~`~`~`~`~`~`~`~`~`~`~J ~`~`~`~`~`~`~`~`~`~`~`~`--if~`a~`spell~`gets~`absorbed,~`there~`are~`3~`additional~`parameters~`regarding~`which~`spell~`got~`absorbed,~`so~`move~`the~`offset~`3~`more~`places~J ~`~`~`~`~`~`~`~`~`~`~`~`if~`GetSpellInfo((select(offset,~`...)))~`==~`(select(offset~`+~`1,~`...))~`then~J ~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`offset~`=~`offset~`+~`3~J ~`~`~`~`~`~`~`~`~`~`~`~`end~J ~`~`~`~`~`~`~`~`~`~`~`~`~J ~`~`~`~`~`~`~`~`~`~`~`~`--absorb~`value~`is~`7~`places~`further~J ~`~`~`~`~`~`~`~`~`~`~`~`offset~`=~`offset~`+~`7~J ~`~`~`~`~`~`~`~`~`~`~`~`tinsert(aura_env.table,~`{GetTime(),~`(select(offset,~`...))})~J ~`~`~`~`~`~`~`~`~`~`~`~`~J ~`~`~`~`~`~`~`~`~`~`~`~`--handle~`regular~`XYZ_DAMAGE~`events~J ~`~`~`~`~`~`~`~`elseif~`subevent:find(\"_DAMAGE\")~`then~J ~`~`~`~`~`~`~`~`~`~`~`~`~J ~`~`~`~`~`~`~`~`~`~`~`~`--don't~`include~`environmental~`damage~`(like~`falling~`etc)~J ~`~`~`~`~`~`~`~`~`~`~`~`if~`not~`subevent:find(\"ENVIRONMENTAL\")~`then~J ~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~J ~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`--move~`offset~`by~`3~`places~`for~`spell~`info~`for~`RANGE_~`and~`SPELL_~`prefixes~J ~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`if~`subevent:find(\"SPELL\")~`then~J ~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`offset~`=~`offset~`+~`3~J ~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`elseif~`subevent:find(\"RANGE\")~`then~J ~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`offset~`=~`offset~`+~`3~J ~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`end~J ~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~J ~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`tinsert(aura_env.table,~`{GetTime(),~`(select(offset,~`...))})~J ~`~`~`~`~`~`~`~`~`~`~`~`end~J ~`~`~`~`~`~`~`~`end~J ~`~`~`~`end~J end~J aura_env:RegisterEvent(\"COMBAT_LOG_EVENT_UNFILTERED\")~J ~J ~J ~J  ^SEvent^SOnEventsRestored ^t^Sn^N1 ^t^SSettingsPerView^T ^Sicon^T ^STexts^T ^N1^S ^N2^S[FrenziedRegen:Short] ^t^t^t^SStates^T ^N1^T ^t^N3^T ^t^N4^T ^t^t^t^N82302^S~`~| ^Sicon^^\n```\n</div>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p> <div class=\"project-issue-comment-body-modified\"> <hr> <span class=\"e-infoLabel\">Edited</span><span> <abbr class=\"tip standard-date standard-datetime\" title=\"11 26 2016 15:18:22 (CST) (UTC-6:00)\" data-epoch=\"1480195102\">Nov 26, 2016</abbr></span> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2016-11-26T21:17:08Z"},{"body":" <p>Sorry to bump such an old thread, but I'm trying to make this function for death strike on my DK.</p>\r\n<p>&nbsp;</p>\r\n<p>Have things changed too much in terms of logging for me to directly apply this? It shows the base heal amount no problem, but seems to draw blanks from damage events (tanking the tank dummy doesn't move the amount from 0).</p>\r\n<p>&nbsp;</p>\r\n<p>The altered lua that I'm using in the icon is&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<div>\n\n```\n-- Frenzied Regen by Hamsda of Mannoroth-EU and Yumari of TheMaelstrom-EU\r\n-- Adapted from the WeakAura at https://wago.io/NkogH0_D-\r\n\r\nlocal icon = ...\r\n\r\nif TMW.hasInitFR then return end\r\nTMW.hasInitFR = true\r\nicon.aura_env = {}\r\nlocal aura_env = icon.aura_env\r\nLibStub(\"AceEvent-3.0\"):Embed(aura_env)\r\n\r\naura_env.showAbsolute = false --set to true to show absolute heal value instead of percentage\r\n\r\naura_env.lastSec = 5\r\naura_env.percDmg = 0.25\r\naura_env.minHealthPerc = 0.07\r\n\r\naura_env.table = {}\r\n\r\n\r\naura_env.text = function(...)\r\n    local i = 1\r\n    local cur = GetTime()\r\n    local total = 0\r\n    \r\n    --get total damage taken\r\n    while aura_env.table[i] do\r\n        --grab table entries with time and damage\r\n        local time = aura_env.table[i][1]\r\n        local dmg = aura_env.table[i][2]\r\n        \r\n        --if the damage happened outside of the timewindow\r\n        if cur &gt; time + aura_env.lastSec then\r\n            --remove the entry\r\n            table.remove(aura_env.table, i)\r\n        else --otherwise\r\n            --add up the damage and go to next entry\r\n            total = total + dmg\r\n            i = i + 1\r\n        end\r\n    end\r\n    \r\n    \r\n    \r\n    \r\n    local heal = total * aura_env.percDmg --damage taken * FR percentage\r\n    local perc = heal / UnitHealthMax(\"player\") --relative to maxHP\r\n    perc = math.max(aura_env.minHealthPerc, perc) --minimum FR percentage\r\n    \r\n    heal = perc * UnitHealthMax(\"player\") --get the actual heal value\r\n    \r\n    return heal\r\nend\r\n\r\nTMW.C.IconComponent:RegisterDogTag(\"TMW\", \"FrenziedRegen\", {\r\n        code = aura_env.text,\r\n        events = \"FastUpdate\",\r\n        ret = \"string\",\r\n        doc = \"Returns the predicted heal amount from Frenzied Regeneration\",\r\n        example = '[FrenziedRegen] =&gt; \"326137\"',\r\n        category = \"Custom\",\r\n})\r\n\r\nfunction aura_env:COMBAT_LOG_EVENT_UNFILTERED(event, time, subevent, ...)\r\n    if select(6, ...) == UnitGUID(\"player\") then\r\n        \r\n        --set selection offset to amount for baseline SWING_DAMAGE\r\n        local offset = 10\r\n        \r\n        --handle SPELL_ABSORBED events\r\n        if subevent == \"SPELL_ABSORBED\" then\r\n            \r\n            --if a spell gets absorbed, there are 3 additional parameters regarding which spell got absorbed, so move the offset 3 more places\r\n            if GetSpellInfo((select(offset, ...))) == (select(offset + 1, ...)) then\r\n                offset = offset + 3\r\n            end\r\n            \r\n            --absorb value is 7 places further\r\n            offset = offset + 7\r\n            tinsert(aura_env.table, {GetTime(), (select(offset, ...))})\r\n            \r\n            --handle regular XYZ_DAMAGE events\r\n        elseif subevent:find(\"_DAMAGE\") then\r\n            \r\n            --don't include environmental damage (like falling etc)\r\n            if not subevent:find(\"ENVIRONMENTAL\") then\r\n                \r\n                --move offset by 3 places for spell info for RANGE_ and SPELL_ prefixes\r\n                if subevent:find(\"SPELL\") then\r\n                    offset = offset + 3\r\n                elseif subevent:find(\"RANGE\") then\r\n                    offset = offset + 3\r\n                end\r\n                \r\n                tinsert(aura_env.table, {GetTime(), (select(offset, ...))})\r\n            end\r\n        end\r\n    end\r\nend\r\naura_env:RegisterEvent(\"COMBAT_LOG_EVENT_UNFILTERED\")\r\n\r\n\r\n\r\n\r\n\n```\n</div>\r\n<p>&nbsp;</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/user_976011\">user_976011</a>","created_at":"2018-09-22T02:31:19Z"}]}