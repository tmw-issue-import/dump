{"issue":{"title":"[CF 1297] Condition Icon &gt; Condition &gt; Consecration: Incorrect Duration ","body":" <p>What steps will reproduce the problem?<br>1. Log in on a (Protection/Holy) Paladin with Consecration and a reasonable amount of haste (&gt;10%).<br>2. Create a condition Icon (use default settings).<br>3. Add a condition: Consecration.<br>4. Exit config mode.<br>5. Cast Consecration.<br>6. Stay in Consecration until the in-game animation (projected texture) disappears.<br>7. Observe how the icon is visible longer than your Consecration buff.</p><p>ADDITIONAL INFORMATION:<br>I've investigated this myself: the Blizzard Totem API (GetTotemInfo/PLAYER_TOTEM_UPDATE) does not account for haste. Working hacky fix:<br>1. Insert the following code after line 509 in TellMeWhen\\Components\\Core\\Conditions\\Categories\\Spells.lua:<br>if duration and duration ~= 0 and UnitClass(\"player\") == \"Paladin\" and name == \"Consecration\" then<br>&nbsp; &nbsp; duration = duration / (1 + GetCombatRatingBonus(CR_HASTE_SPELL) / 100)<br>end<br>2. Change the way conditions of this category are updated: make it update OnUpdate instead of on PLAYER_TOTEM_UPDATE event by removing a few lines after line 530 in the same file:<br>events = function(ConditionObject, c)<br>&nbsp; &nbsp; return<br>&nbsp; &nbsp; &nbsp; &nbsp; ConditionObject:GenerateNormalEventString(\"PLAYER_TOTEM_UPDATE\")<br>end,</p><p>What version of TellMeWhen are you using? (\"The latest\" is not a version)<br>8.1.4</p> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Zeemlap\">Zeemlap</a> | Imported from CurseForge issue <a href=\"https://wow.curseforge.com/projects/tellmewhen/issues/1297\">#1297</a> | <a href=\"https://github.com/tmw-issue-import/dump/blob/master/html/1297.html\">Raw</a>","closed":true,"closed_at":"2018-09-09T22:23:29Z","created_at":"2016-09-11T02:39:14Z","updated_at":"2018-09-09T22:23:29Z","labels":["defect"]},"comments":[{"body":" <p>If this is still a problem, open a new issue. However, I still probably won't do anything about a bug on Blizzard's end.</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2018-09-09T22:23:29Z"}]}