{"issue":{"title":"[CF 810] # of ticks remaining ","body":" <p>Next, do you think it would be possible (or maybe it's possible already too) to set a condition (and lua condition) to the number of ticks remaining on a buff/debuff? I could kinda do this with the time remaining of a buff/debuff but then I'd have to change it whenever my haste changes.</p> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/AmeroGer\">AmeroGer</a> | Imported from CurseForge issue <a href=\"https://wow.curseforge.com/projects/tellmewhen/issues/810\">#810</a> | <a href=\"https://github.com/tmw-issue-import/dump/blob/master/html/810.html\">Raw</a>","closed":true,"closed_at":"2013-05-25T19:09:34Z","created_at":"2013-05-12T03:26:26Z","updated_at":"2013-05-25T19:09:34Z","labels":["enhancement","declined"]},"comments":[{"body":" <p>This is the best that I can do:</p>\r\n<p><code>^1^T^SName^SBuff/Debuff~`tick~`conditions ^SCode^Slocal~`TMW~`=~`TMW~J local~`strlowerCache~`=~`TMW.strlowerCache~J local~`L~`=~`TMW.L~J local~`CNDT~`=~`TMW.CNDT~J ~J local~`t~`=~`{}~J ~J local~`Env~`=~`TMW.CNDT.Env~J ~J Env.AuraApplicationHastes~`=~`t~J ~J ~J local~`pGUID~`=~`UnitGUID(\"player\")~J ~J local~`_,~`pclass~`=~`UnitClass(\"player\")~J ~J local~`GetHaste~`=~`GetMeleeHaste~J ~J if~`pclass~`==~`\"HUNTER\"~`then~J ~`~`~`~`GetHaste~`=~`GetRangedHaste~J elseif~`pclass~`==~`\"WARRIOR\"~`or~`pclass~`==~`\"ROGUE\"~`or~`pclass~`==~`\"DEATHKNIGHT\"~`then~J ~`~`~`~`GetHaste~`=~`GetMeleeHaste~J elseif~`pclass~`==~`\"PRIEST\"~`or~`pclass~`==~`\"WARLOCK\"~`or~`pclass~`==~`\"MAGE\"~`then~J ~`~`~`~`GetHaste~`=~`UnitSpellHaste~`~`~`~`~J else~J ~`~`~`~`GetHaste~`=~`function(unit)~J ~`~`~`~`~`~`~`~`local~`int~`=~`UnitStat(\"player\",~`4)~J ~`~`~`~`~`~`~`~`if~`UnitStat(\"player\",~`1)~`~`&gt;~`int~`or~`UnitStat(\"player\",~`2)~`&gt;~`int~`then~J ~`~`~`~`~`~`~`~`~`~`~`~`return~`GetMeleeHaste()~J ~`~`~`~`~`~`~`~`else~J ~`~`~`~`~`~`~`~`~`~`~`~`return~`UnitSpellHaste(unit)~J ~`~`~`~`~`~`~`~`end~J ~`~`~`~`end~J end~J ~J ~J TMW:RegisterEvent(\"COMBAT_LOG_EVENT_UNFILTERED\",~`function(e,~`_,~`cleuEvent,~`_,~`sourceGUID,~`_,~`_,~`_,~`destGUID,~`_,~`destFlags,~`_,~`spellID,~`spellName)~J ~`~`~`~`~`~`~`~`if~`sourceGUID~`==~`pGUID~`and~`(cleuEvent~`==~`\"SPELL_AURA_APPLIED\"~`or~`cleuEvent~`==~`\"SPELL_AURA_REFRESH\")~`then~J ~`~`~`~`~`~`~`~`~`~`~`~`local~`auras~`=~`t[destGUID]~J ~`~`~`~`~`~`~`~`~`~`~`~`~J ~`~`~`~`~`~`~`~`~`~`~`~`if~`not~`auras~`then~J ~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`auras~`=~`{}~J ~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`t[destGUID]~`=~`auras~J ~`~`~`~`~`~`~`~`~`~`~`~`end~J ~`~`~`~`~`~`~`~`~`~`~`~`spellName~`=~`strlowerCache[spellName]~J ~`~`~`~`~`~`~`~`~`~`~`~`auras[spellName]~`=~`spellID~J ~`~`~`~`~`~`~`~`~`~`~`~`auras[spellID]~`=~`GetHaste(\"player\")/100~J ~`~`~`~`~`~`~`~`~`~`~`~`~J ~`~`~`~`~`~`~`~`elseif~`cleuEvent~`==~`\"UNIT_DIED\"~`then~J ~`~`~`~`~`~`~`~`~`~`~`~`t[destGUID]~`=~`nil~J ~`~`~`~`~`~`~`~`end~J end)~J ~J function~`Env.AuraTicks(unit,~`name,~`namename,~`filter,~`iTicks)~J ~`~`~`~`name~`=~`strlowerCache[name]~J ~`~`~`~`local~`GUID~`=~`UnitGUID(unit)~J ~`~`~`~`if~`not~`GUID~`then~J ~`~`~`~`~`~`~`~`return~`0~J ~`~`~`~`end~J ~`~`~`~`~J ~`~`~`~`local~`auras~`=~`t[GUID]~J ~`~`~`~`if~`not~`auras~`then~J ~`~`~`~`~`~`~`~`return~`0~J ~`~`~`~`end~J ~`~`~`~`~J ~`~`~`~`~J ~`~`~`~`~J ~`~`~`~`local~`perc~`=~`Env.AuraPercent(unit,~`name,~`namename,~`filter)~J ~`~`~`~`if~`perc~`==~`1~`or~`perc~`==~`0~`then~J ~`~`~`~`~`~`~`~`return~`0~J ~`~`~`~`end~J ~`~`~`~`~J ~`~`~`~`~J ~`~`~`~`local~`haste~`=~`auras[name]~J ~`~`~`~`if~`~`type(name)~`==~`\"string\"~`then~J ~`~`~`~`~`~`~`haste~`=~`auras[haste]~`~J ~`~`~`~`end~J ~`~`~`~`~J ~`~`~`~`return~`ceil((haste~`+~`1)~`*~`(perc)~`*~`(iTicks~`-~`1))~J end~J ~J local~`ConditionCategory~`=~`TMW.CNDT:GetCategory(\"BUFFSDEBUFFS\")~J ~J ConditionCategory:RegisterSpacer(100)~J ConditionCategory:RegisterCondition(101,~`~`~`~`~`\"BUFFTICKS\",~`{~J ~`~`~`~`text~`=~`L[\"ICONMENU_BUFF\"]~`..~`\"~`-~`\"~`..~`\"Ticks\",~J ~`~`~`~`tooltip~`=~`\"Specify~`the~`number~`of~`ticks~`in~`a~`normal,~`unhasted~`applcation~`of~`the~`debuff~`using~`the~`spell:~`duration~`syntax.\",~J ~`~`~`~`range~`=~`6,~J ~`~`~`~`step~`=~`1,~J ~`~`~`~`name~`=~`function(editbox)~`TMW:TT(editbox,~`\"BUFFTOCHECK\",~`\"BUFFCNDT_DESC\")~`editbox.label~`=~`L[\"BUFFTOCHECK\"]~`end,~J ~`~`~`~`useSUG~`=~`true,~J ~`~`~`~`icon~`=~`\"Interface\\\\Icons\\\\spell_nature_rejuvenation\",~J ~`~`~`~`tcoords~`=~`CNDT.COMMON.standardtcoords,~J ~`~`~`~`funcstr~`=~`function(c)~J ~`~`~`~`~`~`~`~`local~`ticks~`=~`TMW:GetSpellDurations(nil,~`c.Name)~J ~`~`~`~`~`~`~`~`return~`[[AuraTicks(c.Unit,~`c.NameFirst,~`c.NameName,~`\"HELPFUL\",~`]]~`..~`(ticks[1]~`or~`0)~`..~`[[)~`c.Operator~`c.Level]]~J ~`~`~`~`end,~J })~J ConditionCategory:RegisterCondition(101,~`~`~`~`~`\"DEBUFFTICKS\",~`{~J ~`~`~`~`text~`=~`L[\"ICONMENU_DEBUFF\"]~`..~`\"~`-~`\"~`..~`\"Ticks\",~J ~`~`~`~`tooltip~`=~`\"Specify~`the~`number~`of~`ticks~`in~`a~`normal,~`unhasted~`applcation~`of~`the~`debuff~`using~`the~`spell:~`duration~`syntax.\",~J ~`~`~`~`range~`=~`6,~J ~`~`~`~`step~`=~`1,~J ~`~`~`~`name~`=~`function(editbox)~`TMW:TT(editbox,~`\"DEBUFFTOCHECK\",~`\"BUFFCNDT_DESC\")~`editbox.label~`=~`L[\"DEBUFFTOCHECK\"]~`end,~J ~`~`~`~`useSUG~`=~`true,~J ~`~`~`~`icon~`=~`\"Interface\\\\Icons\\\\spell_shadow_abominationexplosion\",~J ~`~`~`~`tcoords~`=~`CNDT.COMMON.standardtcoords,~J ~`~`~`~`funcstr~`=~`function(c)~J ~`~`~`~`~`~`~`~`local~`ticks~`=~`TMW:GetSpellDurations(nil,~`c.Name)~J ~`~`~`~`~`~`~`~`return~`[[AuraTicks(c.Unit,~`c.NameFirst,~`c.NameName,~`\"HARMFUL\",~`]]~`..~`(ticks[1]~`or~`0)~`..~`[[)~`c.Operator~`c.Level]]~J ~`~`~`~`end,~J })~J ^t^N62056^S~`~| ^Scodesnippet^^</code></p>\r\n<p>To use the two conditions it will create when you import (and run the code or reload your UI), you need to specify the number of ticks that are in a normal, unhasted cast of the aura you are tracking using the colon duration syntax. For example:</p>\r\n<p><code>^1^T^SType^Sconditionicon ^SConditions^T ^N1^T ^SType^SDEBUFFTICKS ^SOperator^S&lt; ^SUnit^Starget ^SName^SSerpent~`Sting:~`5 ^SLevel^N3 ^t^Sn^N1 ^t^SCustomTex^S1978 ^SEnabled^B ^t^N62056^S~`~| ^Sicon^^</code></p>\r\n<p>It isn't going to be very accurate/reliable because there are so many factors that go into determining this. Duration extensions beyond normal duration caused by reapplying the aura are going to screw things up quite a bit. In most normal cases, it might be reliable within one tick, but I still can't make any guarantees. Ticks are not synchronized with when they actually happen.</p>\r\n<p>That might be a better way to implement this (synchronization with actual ticks when they happen), but it would have to be implemented alongside this implementation I just wrote (prediction based on haste and cast time) since number of ticks couldn't be predicted using previous tick times unless there have already been two. I just don't have time to implement something as extensive as that - it would be quite an elaborate system that could take a day or two, and my WoW sub ends 12 hours from now (although I do still have the PTR to screw around with addons after that).</p>\r\n<p>I do want to move away from TMW completely now that my sub is over. There are still a few things left to document that I will get around to when I have time, and I will still be hopping on the beta servers for whatever the next expansion is when they give us our free addon author keys, but aside from that (and bugfixes as needed), I am done with WoW and with TMW, so I won't be able to help you come up with these specialized solutions anymore.</p>\r\n<p>I'll still be around though, and I will still be keeping up with more basic questions (including keeping up with the comments on Curse.com to the best of my ability (whatever that is without an active subscription anymore)), so feel free to continue to hit me up with questions/suggestions/etc. I just can't guarantee that I will be able to help you as much as I have been.</p> <div class=\"project-issue-comment-body-modified\"> <hr> <span class=\"e-infoLabel\">Edited</span><span> <abbr class=\"tip standard-date standard-datetime\" title=\"05 11 2013 23:41:15 (CDT) (UTC-5:00)\" data-epoch=\"1368333675\">May 11, 2013</abbr></span> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2013-05-12T04:40:27Z"},{"body":" <p>I remeber a simple formula like this, don't need to track CLEU.<br>\r\nticks = round (base time of tick * base ticks number * 1000 / round (1000 * base time of tick / haste))</p> <div class=\"project-issue-comment-body-modified\"> <hr> <span class=\"e-infoLabel\">Edited</span><span> <abbr class=\"tip standard-date standard-datetime\" title=\"05 12 2013 00:45:33 (CDT) (UTC-5:00)\" data-epoch=\"1368337533\">May 12, 2013</abbr></span> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/lsjyzjl\">lsjyzjl</a>","created_at":"2013-05-12T05:42:07Z"}]}