{"issue":{"title":"[CF 1495] When creating a new IconType I cannot get condition opacity to work ","body":" <p>I have implemented a <a href=\"https://github.com/arieh/TellMeWhen_Script_Tools/blob/master/Dynamic_Bar.lua\" rel=\"nofollow\">new Bar Type</a>, however, I cannot get the condition sliders to affect my UI- my bar is always 100% visible, no matter what the state of my condition is.&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p>If I remove the registration of the XML Templates I can get the condition to hide my icon but then I don't get the opacity settings.</p>\r\n<p>&nbsp;</p>\r\n<p>I suspect it might have to do with <a href=\"https://github.com/arieh/TellMeWhen_Script_Tools/blob/master/Dynamic_Bar.lua#L105\" rel=\"nofollow\">this line</a>&nbsp;(note that this is part of Type:Setup so it only runs once) which is not present in any other type I looked at but if I remove it my icon is always hidden.</p>\r\n<p>&nbsp;</p>\r\n<p>I noticed all icons, when a condition is present, have a condition failed slider appear on them. Is there a simple way for me to inherit this functionality?</p>\r\n<p>&nbsp;</p>\r\n<p>I know this is a very deep dive but I'm not sure where to look, so any help will be greatly appreciated.&nbsp;</p> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/ariehg\">ariehg</a> | Imported from CurseForge issue <a href=\"https://wow.curseforge.com/projects/tellmewhen/issues/1495\">#1495</a> | <a href=\"https://github.com/tmw-issue-import/dump/blob/master/html/1495.html\">Raw</a>","closed":true,"closed_at":"2018-05-13T04:59:39Z","created_at":"2018-05-10T20:18:28Z","updated_at":"2018-05-13T04:59:39Z","labels":[]},"comments":[{"body":" <p>You'll need to register the panel regardless of whether your icon has any custom states or not.&nbsp;</p>\r\n<div>\r\n<div>&nbsp;</div>\r\n<div>Type:RegisterConfigPanel_XMLTemplate(165, \"TellMeWhen_IconStates\", {})</div>\r\n<div>&nbsp;</div>\r\n</div>\r\n<div>An unfortunate consequence of this is that the panel will show up as empty if there are no conditions. I've already fixed this in the BfA version of TMW. Your question also led me to notice the meta icons were also missing this config panel, so thanks!</div>\r\n<div>&nbsp;</div>\r\n<div>In regards to the icon:SetInfo(\"state\", 1) line - the 1 here is corresponding to the default settings for TMW.CONST.STATE.DEFAULT_SHOW (<a href=\"https://github.com/ascott18/TellMeWhen/blob/master/TellMeWhen.lua#L179\" rel=\"nofollow\">https://github.com/ascott18/TellMeWhen/blob/master/TellMeWhen.lua#L179</a>, <a href=\"https://github.com/ascott18/TellMeWhen/blob/master/TellMeWhen.lua#L261\" rel=\"nofollow\">https://github.com/ascott18/TellMeWhen/blob/master/TellMeWhen.lua#L261</a>). No other icon type has this because all other icon types set the state of the icon through all code paths of their update function. Since yours doesn't, you need to initialize it in Type:Setup().</div>\r\n<div>&nbsp;</div>\r\n<div>You will want to use at least one custom state (DEFAULT_SHOW, at least) with your icon, for the following reasons:</div>\r\n<ul>\r\n<li>You'll run into some unfortunate consequences if someone configures the opacity/color for that state with some other icon type, and then switches to your icon type - your icon will use that setting but be unable to configure it.&nbsp;</li>\r\n<li>Users will be unable to configure a baseline opacity/icon color for the icon type without it.</li>\r\n<li>The config weirdness I mentioned with the panel being empty until BfA.</li>\r\n</ul>\r\n<p>I see you already have a \"show\" member on your icon.script_values object. You could set state to DEFAULT_SHOW if this is true and set it to 0 otherwise (0 is a magic number that isn't a real state, but effectively means \"hide\").</p>\r\n<p>&nbsp;</p>\r\n<p>I'm going to submit a PR in a little bit with some other tweaks you could make to the icon type. But so far, its looking good!</p> <div class=\"project-issue-comment-body-modified\"> <hr> <span class=\"e-infoLabel\">Edited</span><span> <abbr class=\"tip standard-date standard-datetime\" title=\"05 11 2018 22:09:01 (CST) (UTC-5:00)\" data-epoch=\"1526094541\">May 11, 2018</abbr></span> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2018-05-12T03:03:55Z"},{"body":" <p>Thanks for the response!</p>\r\n<p>&nbsp;</p>\r\n<p>To make sure I understand correctly - what I want to add is something like:</p>\r\n<p>&nbsp;</p>\r\n<div>\n\n```\nType:RegisterConfigPanel_XMLTemplate(165, \"TellMeWhen_IconStates\", {\r\n    [ DEFAULT_SHOW ] : \"Show me\",\r\n    [ DEFAULT_HIDE ] : \"Hide me\"\r\n})\n```\n</div>\r\n<p>&nbsp;And this will both make my icons appear by default and allow the condition opacity slider to appear?</p>\r\n<p>&nbsp;</p>\r\n<p>Edit - tried it - sliders appear but icons are always hidden and playing with sliders has not effect....</p> <div class=\"project-issue-comment-body-modified\"> <hr> <span class=\"e-infoLabel\">Edited</span><span> <abbr class=\"tip standard-date standard-datetime\" title=\"05 12 2018 14:45:41 (CST) (UTC-5:00)\" data-epoch=\"1526154341\">May 12, 2018</abbr></span> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/ariehg\">ariehg</a>","created_at":"2018-05-12T19:36:33Z"},{"body":" <p>Check out the pull request I made on GitHub.</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2018-05-13T02:33:51Z"},{"body":" <p>Oh I didnt notice :) (though you did write so :) )</p>\r\n<p>&nbsp;</p>\r\n<p>Thanks a lot for giving it such a deep look! This makes a lot of sense to me :)</p>\r\n<p>&nbsp;</p>\r\n<p>I know there are some \"over optimizations\" there, but I feel like it's a safe coding thing, especially since I'm so unfamiliar with a lot of how to code works.&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p>As mentioned before - it's quite amazing to me how extensible the framework behind TMW is. It's my first time going into LUA and it's a great learning source :)&nbsp;</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/ariehg\">ariehg</a>","created_at":"2018-05-13T04:59:39Z"}]}