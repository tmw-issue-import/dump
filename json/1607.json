{"issue":{"title":"[CF 1607] Track empowered assasination rogue debuffs ","body":" <p>I just made long video in pt-br explaining TellMeWhen. I'm trying to move from WA to TMW in my assassination spec.</p>\r\n<p>&nbsp;</p>\r\n<p>The problem is how to setup a track for empowered debuffs (garrote debuff with subterfuge talent). Tried using Combat event and counter but no luck so far.</p>\r\n<p>&nbsp;</p>\r\n<p>WA is using lua code, any way to replicate this behavior on TMW?</p>\r\n<p>&nbsp;</p>\r\n<p>offtopic: ffs curse sucks, there is no way to search past issues? Pls consider a mirror at github/gitlab</p>\r\n<p>&nbsp;</p>\r\n<div>\n\n```\nfunction(event, _, type, _, src, _, _, _, dest, _, _, _, spellId)\r\n    if event ~= \"COMBAT_LOG_EVENT_UNFILTERED\" then return end\r\n    \r\n    if src ~= UnitGUID(\"player\") then return end\r\n    \r\n    -- Check for Nightstalker rupture\r\n    if IsPlayerSpell(14062) or IsPlayerSpell(200806) then\r\n        \r\n        --init table for target on applying rupture\r\n        if type == \"SPELL_CAST_SUCCESS\" and spellId == 1943 then\r\n            if (_G['RuptureDB'][dest] == nil) then\r\n                _G['RuptureDB'][dest] = {dest, [\"NS\"] = false,\r\n                    [\"Exsang\"] = false}\r\n            else\r\n                _G['RuptureDB'][dest][\"Exsang\"] = false\r\n            end\r\n            \r\n            -- set Nightstalker bool\r\n            if IsStealthed() then\r\n                _G['RuptureDB'][dest][\"NS\"] = true\r\n            else\r\n                _G['RuptureDB'][dest][\"NS\"] = false\r\n            end\r\n            \r\n        elseif type == \"SPELL_AURA_REMOVED\" and spellId ==  1943 then\r\n            \r\n            _G['RuptureDB'][dest] = nil\r\n        end\r\n        \r\n    end\r\n    \r\n    -- Check for exanguinate\r\n    if type == \"SPELL_CAST_SUCCESS\" and spellId == 200806 then\r\n        if (_G['RuptureDB'][dest] ~= nil) then\r\n            _G['RuptureDB'][dest][\"Exsang\"] = true\r\n        end\r\n    end    \r\n    \r\n    -- Check for subterfuge garrote\r\n    if type == \"SPELL_AURA_APPLIED\" or  type == \"SPELL_CAST_SUCCESS\" then\r\n        if spellId == 703 then\r\n            if IsStealthed() or AuraUtil.FindAuraByName(GetSpellInfo(108208), \"player\")\r\n            then\r\n                _G['GarroteDB'][dest] =true \r\n            else\r\n                _G['GarroteDB'][dest] = nil\r\n                \r\n            end\r\n        end\r\n    elseif type == \"SPELL_AURA_REMOVED\" and spellId == 703 then\r\n        _G['GarroteDB'][dest] = nil\r\n    end\r\nend\r\n\r\n\n```\n</div>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/dvdscripter\">dvdscripter</a> | Imported from CurseForge issue <a href=\"https://wow.curseforge.com/projects/tellmewhen/issues/1607\">#1607</a> | <a href=\"https://github.com/tmw-issue-import/dump/blob/master/html/1607.html\">Raw</a>","closed":true,"closed_at":"2018-12-25T00:55:03Z","created_at":"2018-11-01T14:40:44Z","updated_at":"2018-12-25T00:55:03Z","labels":[]},"comments":[{"body":" <p>I don't know how all the data that is being set in _G.GarroteDB and _G.RuptureDB is being used, so there's not much I can do with this.</p>\r\n<p>&nbsp;</p>\r\n<p>Here's an icon that will register this event and record data into those variables.</p>\r\n<p>&nbsp;</p>\r\n<p><span style=\"font-family:courier new, courier, monospace;font-size:8px\">^1^T^SType^Scooldown ^SEvents^T ^N1^T ^SType^SLua ^SLua^S--~`&lt;Untitled~`Lua~`Code&gt;~J ~J local~`icon~`=~`...~J ~J --Your~`code~`goes~`here:~J ~J if~`icon.GarroteDB~`then~`return~`end~J icon.GarroteDB~`=~`{}~J icon.RuptureDB~`=~`{}~J local~`GarroteDB~`=~`icon.GarroteDB~J local~`RuptureDB~`=~`icon.RuptureDB~J ~J LibStub(\"AceEvent-3.0\"):Embed(GarroteDB)~J ~J GarroteDB:RegisterEvent(\"COMBAT_LOG_EVENT_UNFILTERED\",~`function()~J ~`~`~`~`~`~`~`~`local~`~`_,~`type,~`_,~`src,~`_,~`_,~`_,~`dest,~`_,~`_,~`_,~`spellId~`=~`CombatLogGetCurrentEventInfo()~J ~`~`~`~`~`~`~`~`~J ~`~`~`~`~`~`~`~`~J ~`~`~`~`~`~`~`~`if~`src~`~|=~`UnitGUID(\"player\")~`then~`return~`end~J ~`~`~`~`~`~`~`~`~J ~`~`~`~`~`~`~`~`--~`Check~`for~`Nightstalker~`rupture~J ~`~`~`~`~`~`~`~`if~`IsPlayerSpell(14062)~`or~`IsPlayerSpell(200806)~`then~J ~`~`~`~`~`~`~`~`~`~`~`~`~J ~`~`~`~`~`~`~`~`~`~`~`~`--init~`table~`for~`target~`on~`applying~`rupture~J ~`~`~`~`~`~`~`~`~`~`~`~`if~`type~`==~`\"SPELL_CAST_SUCCESS\"~`and~`spellId~`==~`1943~`then~J ~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`if~`(RuptureDB[dest]~`==~`nil)~`then~J ~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`RuptureDB[dest]~`=~`{dest,~`[\"NS\"]~`=~`false,~J ~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`[\"Exsang\"]~`=~`false}~J ~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`else~J ~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`RuptureDB[dest][\"Exsang\"]~`=~`false~J ~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`end~J ~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~J ~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`--~`set~`Nightstalker~`bool~J ~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`if~`IsStealthed()~`then~J ~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`RuptureDB[dest][\"NS\"]~`=~`true~J ~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`else~J ~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`RuptureDB[dest][\"NS\"]~`=~`false~J ~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`end~J ~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~J ~`~`~`~`~`~`~`~`~`~`~`~`elseif~`type~`==~`\"SPELL_AURA_REMOVED\"~`and~`spellId~`==~`~`1943~`then~J ~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~J ~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`RuptureDB[dest]~`=~`nil~J ~`~`~`~`~`~`~`~`~`~`~`~`end~J ~`~`~`~`~`~`~`~`~`~`~`~`~J ~`~`~`~`~`~`~`~`end~J ~`~`~`~`~`~`~`~`~J ~`~`~`~`~`~`~`~`--~`Check~`for~`exanguinate~J ~`~`~`~`~`~`~`~`if~`type~`==~`\"SPELL_CAST_SUCCESS\"~`and~`spellId~`==~`200806~`then~J ~`~`~`~`~`~`~`~`~`~`~`~`if~`(RuptureDB[dest]~`~|=~`nil)~`then~J ~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`RuptureDB[dest][\"Exsang\"]~`=~`true~J ~`~`~`~`~`~`~`~`~`~`~`~`end~J ~`~`~`~`~`~`~`~`end~`~`~`~`~J ~`~`~`~`~`~`~`~`~J ~`~`~`~`~`~`~`~`--~`Check~`for~`subterfuge~`garrote~J ~`~`~`~`~`~`~`~`if~`type~`==~`\"SPELL_AURA_APPLIED\"~`or~`~`type~`==~`\"SPELL_CAST_SUCCESS\"~`then~J ~`~`~`~`~`~`~`~`~`~`~`~`if~`spellId~`==~`703~`then~J ~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`if~`IsStealthed()~`or~`AuraUtil.FindAuraByName(GetSpellInfo(108208),~`\"player\")~J ~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`then~J ~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`GarroteDB[dest]~`=true~`~J ~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`else~J ~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`GarroteDB[dest]~`=~`nil~J ~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~J ~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`~`end~J ~`~`~`~`~`~`~`~`~`~`~`~`end~J ~`~`~`~`~`~`~`~`elseif~`type~`==~`\"SPELL_AURA_REMOVED\"~`and~`spellId~`==~`703~`then~J ~`~`~`~`~`~`~`~`~`~`~`~`GarroteDB[dest]~`=~`nil~J ~`~`~`~`~`~`~`~`end~J end) ^SEvent^SOnEventsRestored ^t^Sn^N1 ^t^SEnabled^B ^SStates^T ^N1^T ^t^N3^T ^t^N4^T ^t^t^t^N85503^S~`~| ^Sicon^^</span></p>\r\n<p>&nbsp;</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2018-11-03T23:29:59Z"},{"body":" <p>Thanks for replying!</p>\r\n<p>&nbsp;</p>\r\n<p>I want to track when garrote/rupture/exanguinate are empowered. When I select a target debuff can have three states:</p>\r\n<ol>\r\n<li>No debuff: do not show (easy part)</li>\r\n<li>Check if target (GarroteDB[dest]) == true then activate border or change timer number color to green (some form to distingue)</li>\r\n<li>Else (false) then only show standard tmw icon when debuff is present at target</li>\r\n</ol>\r\n<p>These conditions for rupture and exanguinate too.</p>\r\n<p>&nbsp;</p>\r\n<p>The reasoning is if I override empowered debuff in pandemic window its a DPS loss. I should let debuff run out.</p>\r\n<p>Is possible to do this without lua? My question now is how to evaluate if GarroteDB[dest] is true on another condition icon? How to set dest to make GarroteDB[dest] work?</p>\r\n<p>&nbsp;</p>\r\n<p>Thanks !</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/dvdscripter\">dvdscripter</a>","created_at":"2018-11-04T15:46:18Z"},{"body":" <p>Lua table from Garrote wa:</p>\r\n<p>&nbsp;</p>\r\n<div>\n\n```\n{\r\n    [\"glow\"] = false,\r\n    [\"text1FontSize\"] = 17,\r\n    [\"xOffset\"] = 35,\r\n    [\"customText\"] = \"function(progress,...)    \\\\n    local target = UnitGUID(\\\\\\\"target\\\\\\\")\\\\n    local remaining = progress - GetTime()\\\\n    \\\\n    if _G['GarroteDB'] ~= nil and _G[\\\\\\\"GarroteDB\\\\\\\"][target] ~= nil then\\\\n        return \\\\\\\"\\\\\\\"..format(\\\\\\\"%.f\\\\\\\", remaining)\\\\n    else\\\\n        return \\\\\\\"\\\\\\\"..format(\\\\\\\"%.f\\\\\\\", remaining)\\\\n    end\\\\nend\\\\n\\\\n\\\\n\\\\n\",\r\n    [\"yOffset\"] = -82.000061035156,\r\n    [\"anchorPoint\"] = \"CENTER\",\r\n    [\"customTextUpdate\"] = \"update\",\r\n    [\"url\"] = \"https://wago.io/rJvtp6ssm/1\",\r\n    [\"actions\"] = {\r\n        [\"start\"] = {\r\n        },\r\n        [\"init\"] = {\r\n        },\r\n        [\"finish\"] = {\r\n        },\r\n    },\r\n    [\"triggers\"] = {\r\n        [1] = {\r\n            [\"trigger\"] = {\r\n                [\"rem\"] = \"5.4\",\r\n                [\"subeventSuffix\"] = \"_CAST_START\",\r\n                [\"debuffType\"] = \"HARMFUL\",\r\n                [\"ownOnly\"] = true,\r\n                [\"event\"] = \"Health\",\r\n                [\"subeventPrefix\"] = \"SPELL\",\r\n                [\"unit\"] = \"target\",\r\n                [\"type\"] = \"aura\",\r\n                [\"spellIds\"] = {\r\n                },\r\n                [\"remOperator\"] = \"&gt;=\",\r\n                [\"names\"] = {\r\n                    [1] = \"Garrote\",\r\n                },\r\n                [\"buffShowOn\"] = \"showOnActive\",\r\n                [\"custom_hide\"] = \"timed\",\r\n            },\r\n            [\"untrigger\"] = {\r\n            },\r\n        },\r\n        [\"activeTriggerMode\"] = 1,\r\n    },\r\n    [\"text1Enabled\"] = true,\r\n    [\"keepAspectRatio\"] = false,\r\n    [\"animation\"] = {\r\n        [\"start\"] = {\r\n            [\"type\"] = \"preset\",\r\n            [\"preset\"] = \"shrink\",\r\n            [\"duration_type\"] = \"seconds\",\r\n        },\r\n        [\"main\"] = {\r\n            [\"type\"] = \"none\",\r\n            [\"duration_type\"] = \"seconds\",\r\n        },\r\n        [\"finish\"] = {\r\n            [\"type\"] = \"preset\",\r\n            [\"preset\"] = \"shrink\",\r\n            [\"duration_type\"] = \"seconds\",\r\n        },\r\n    },\r\n    [\"stickyDuration\"] = false,\r\n    [\"progressPrecision\"] = 0,\r\n    [\"text1Point\"] = \"CENTER\",\r\n    [\"text2FontFlags\"] = \"OUTLINE\",\r\n    [\"height\"] = 30,\r\n    [\"load\"] = {\r\n        [\"ingroup\"] = {\r\n            [\"multi\"] = {\r\n            },\r\n        },\r\n        [\"use_never\"] = false,\r\n        [\"talent\"] = {\r\n            [\"multi\"] = {\r\n            },\r\n        },\r\n        [\"talent2\"] = {\r\n            [\"multi\"] = {\r\n            },\r\n        },\r\n        [\"class\"] = {\r\n            [\"single\"] = \"ROGUE\",\r\n            [\"multi\"] = {\r\n            },\r\n        },\r\n        [\"difficulty\"] = {\r\n            [\"multi\"] = {\r\n            },\r\n        },\r\n        [\"role\"] = {\r\n            [\"multi\"] = {\r\n            },\r\n        },\r\n        [\"use_class\"] = true,\r\n        [\"race\"] = {\r\n            [\"multi\"] = {\r\n            },\r\n        },\r\n        [\"use_spec\"] = true,\r\n        [\"faction\"] = {\r\n            [\"multi\"] = {\r\n            },\r\n        },\r\n        [\"pvptalent\"] = {\r\n            [\"multi\"] = {\r\n            },\r\n        },\r\n        [\"use_combat\"] = true,\r\n        [\"spec\"] = {\r\n            [\"single\"] = 1,\r\n            [\"multi\"] = {\r\n            },\r\n        },\r\n        [\"size\"] = {\r\n            [\"multi\"] = {\r\n            },\r\n        },\r\n    },\r\n    [\"text2Enabled\"] = false,\r\n    [\"text1Font\"] = \"Expressway\",\r\n    [\"text2Containment\"] = \"INSIDE\",\r\n    [\"cooldownTextEnabled\"] = true,\r\n    [\"text1Color\"] = {\r\n        [1] = 1,\r\n        [2] = 1,\r\n        [3] = 1,\r\n        [4] = 1,\r\n    },\r\n    [\"desaturate\"] = false,\r\n    [\"parent\"] = \"DebuffsAssa\",\r\n    [\"text1FontFlags\"] = \"OUTLINE\",\r\n    [\"regionType\"] = \"icon\",\r\n    [\"internalVersion\"] = 9,\r\n    [\"text1Containment\"] = \"INSIDE\",\r\n    [\"text2FontSize\"] = 24,\r\n    [\"selfPoint\"] = \"CENTER\",\r\n    [\"text1\"] = \"%c\",\r\n    [\"anchorFrameType\"] = \"SCREEN\",\r\n    [\"alpha\"] = 1,\r\n    [\"text2\"] = \"%p\",\r\n    [\"auto\"] = true,\r\n    [\"text2Point\"] = \"CENTER\",\r\n    [\"id\"] = \"G\",\r\n    [\"icon\"] = true,\r\n    [\"frameStrata\"] = 3,\r\n    [\"width\"] = 35,\r\n    [\"zoom\"] = 0,\r\n    [\"uid\"] = \"Rburt1qA090\",\r\n    [\"inverse\"] = false,\r\n    [\"text2Color\"] = {\r\n        [1] = 1,\r\n        [2] = 1,\r\n        [3] = 1,\r\n        [4] = 1,\r\n    },\r\n    [\"conditions\"] = {\r\n        [1] = {\r\n            [\"check\"] = {\r\n                [\"trigger\"] = 1,\r\n                [\"op\"] = \"&lt;=\",\r\n                [\"value\"] = \"5.4\",\r\n                [\"variable\"] = \"expirationTime\",\r\n            },\r\n            [\"changes\"] = {\r\n                [1] = {\r\n                    [\"value\"] = true,\r\n                    [\"property\"] = \"glow\",\r\n                },\r\n            },\r\n        },\r\n    },\r\n    [\"color\"] = {\r\n        [1] = 1,\r\n        [2] = 1,\r\n        [3] = 1,\r\n        [4] = 1,\r\n    },\r\n    [\"text2Font\"] = \"Friz Quadrata TT\",\r\n}\n```\n</div>\r\n<p>&nbsp;Only lua code:</p>\r\n<p>&nbsp;</p>\r\n<div>\n\n```\nfunction(progress,...)    \r\n    local target = UnitGUID(\"target\")\r\n    local remaining = progress - GetTime()\r\n    \r\n    if _G['GarroteDB'] ~= nil and _G[\"GarroteDB\"][target] ~= nil then\r\n        return \"|cFF00FF00\"..format(\"%.f\", remaining)\r\n    else\r\n        return \"|cFFFFFFFF\"..format(\"%.f\", remaining)\r\n    end\r\nend\r\n\r\n\r\n\r\n\n```\n</div>\r\n<p>&nbsp;</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/dvdscripter\">dvdscripter</a>","created_at":"2018-11-05T13:52:34Z"},{"body":" <p>why are you using combat log to track unit debuffs? Why not just have icons with conditions for each state (player buff/target debuff combos)?</p>\r\n<p>&nbsp;</p>\r\n<p>I havent played rogue much, but I'm assuming -&nbsp;</p>\r\n<p>1. You target has a bleed you want to track</p>\r\n<p>2. You have a buff that you want to use only when target buff is within certain window</p>\r\n<p>&nbsp;</p>\r\n<p>When you want to have an icon that only appears in certain conditions, use the \"conditions\" tab for that icon (it's at the bottom) and configure as many conditions as you want. Sound like you want to use Buffs/Debuffs based on duration.</p>\r\n<p>&nbsp;</p>\r\n<p>In terms of changing how the icon looks like - in TMW you can't really change icon text (eg their color). You will need to have multiple icons for different text colors. You can however make the icon color change and add/remove activation border using the Notifications tab &gt; Animation</p> <div class=\"project-issue-comment-body-modified\"> <hr> <span class=\"e-infoLabel\">Edited</span><span> <abbr class=\"tip standard-date standard-datetime\" title=\"11 14 2018 11:13:18 (CST) (UTC-6:00)\" data-epoch=\"1542215598\">Nov 14, 2018</abbr></span> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/ariehg\">ariehg</a>","created_at":"2018-11-14T17:06:25Z"},{"body":" <p>Yeah. But garrote debuff has 2 states: empowered and not empowered. The only way I can tell them apart is by using the WA I pasted above.</p>\r\n<p>&nbsp;</p>\r\n<p>Again, garrote debuff has the same spellID empowered or not. How I'll track the empowered state?</p>\r\n<p>&nbsp;</p>\r\n<p>Thanks</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/dvdscripter\">dvdscripter</a>","created_at":"2018-11-20T00:51:39Z"}]}