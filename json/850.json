{"issue":{"title":"[CF 850] Script ran too long lua error ","body":" <p>1x ...\\TellMeWhen\\Components\\EventHandlers\\Sound\\Sound.lua:92: script ran too long<br>...\\TellMeWhen\\Components\\EventHandlers\\Sound\\Sound.lua:92: in function \"HandleEvent\"<br>TellMeWhen-6.2.2-12-gc614c25\\Components\\Core\\Icon.lua:546: in function &lt;TellMeWhen\\Components\\Core\\Icon.lua:504&gt;<br>(tail call): ?<br>&lt;in C code&gt;<br>&lt;string&gt;:\"safecall Dispatcher[1]\":9: in function &lt;string&gt;:\"safecall Dispatcher[1]\":5<br>(tail call): ?<br>Components\\Core\\IconEvents\\EventHandler.lua:256: in function &lt;Components\\Core\\IconEvents\\EventHandler.lua:248&gt;<br>(tail call): ?<br>&lt;in C code&gt;<br>&lt;string&gt;:\"safecall Dispatcher[3]\":9: in function &lt;string&gt;:\"safecall Dispatcher[3]\":5<br>(tail call): ?<br>TellMeWhen\\TellMeWhen-6.2.2-12-gc614c25.lua:1409: in function \"Fire\"<br>TellMeWhen\\TellMeWhen-6.2.2-12-gc614c25.lua:2552: in function &lt;TellMeWhen\\TellMeWhen.lua:2505&gt;</p><p>Locals:<br>nil</p> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/lsjyzjl\">lsjyzjl</a> | Imported from CurseForge issue <a href=\"https://wow.curseforge.com/projects/tellmewhen/issues/850\">#850</a> | <a href=\"https://github.com/tmw-issue-import/dump/blob/master/html/850.html\">Raw</a>","closed":true,"closed_at":"2013-08-03T10:51:49Z","created_at":"2013-07-31T08:09:53Z","updated_at":"2013-08-03T11:04:16Z","labels":["defect","resolved"]},"comments":[{"body":" <p>1x &lt;string&gt;:\"safecall Dispatcher[1]\":9: script ran too long<br>\r\n&lt;string&gt;:\"safecall Dispatcher[1]\":9: in function &lt;string&gt;:\"safecall Dispatcher[1]\":5<br>\r\n(tail call): ?<br>\r\nComponents\\Core\\IconEvents\\EventHandler.lua:256 in function &lt;Components\\Core\\IconEvents\\EventHandler.lua:248<br>\r\n(tail call): ?<br>\r\n&lt;in C code&gt;<br>\r\n&lt;string&gt;:\"safecall Dispatcher[3]\":9: in function &lt;string&gt;:\"safecall Dispatcher[3]\":5<br>\r\n(tail call): ?<br>\r\nTellMeWhen\\TellMeWhen-6.2.2-12-gc614c25.lua:1409 in function \"Fire\"<br>\r\nTellMeWhen\\TellMeWhen-6.2.2-12-gc614c25.lua:2552 in function &lt;TellMeWhen\\TellMeWhen.lua:2505</p>\r\n<p>Locals:<br>\r\nnil</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/lsjyzjl\">lsjyzjl</a>","created_at":"2013-07-31T08:10:19Z"},{"body":" <p>1x &lt;string&gt;:\"safecall Dispatcher[3]\":9: script ran too long<br>\r\n&lt;string&gt;:\"safecall Dispatcher[3]\":9: in function &lt;string&gt;:\"safecall Dispatcher[3]\":5<br>\r\n(tail call): ?<br>\r\nTellMeWhen\\TellMeWhen-6.2.2-12-gc614c25.lua:1409 in function \"Fire\"<br>\r\nTellMeWhen\\TellMeWhen-6.2.2-12-gc614c25.lua:2552 in function &lt;TellMeWhen\\TellMeWhen.lua:2505</p>\r\n<p>Locals:<br>\r\n(*temporary) = 0.024000000208616<br>\r\n(*temporary) = &lt;func&gt; =[C]:-1</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/lsjyzjl\">lsjyzjl</a>","created_at":"2013-07-31T08:10:34Z"},{"body":" <p>^1^T^SUnit^Starget ^SType^Scast ^SConditions^T ^N1^T ^SType^SREACT ^SUnit^Starget ^SLevel^N1 ^t^N2^T ^SType^SEXISTS ^SUnit^Starget ^t^Sn^N2 ^t^SEvents^T ^N1^T ^SType^SSound ^SSound^STMW~`-~`Pling~`6 ^SEvent^SOnShow ^t^Sn^N1 ^t^SSettingsPerView^T ^Sicon^T ^STexts^T ^N1^S打斷 ^N2^S ^t^t^t^SInterruptible^B ^SEnabled^B ^SFakeHidden^B ^t^N62302^S~`~| ^Sicon^^</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/lsjyzjl\">lsjyzjl</a>","created_at":"2013-07-31T08:11:44Z"},{"body":" <p>This one is coming from PlaySoundFile(), so it looks to be an issue on Blizzard's end of things - my best guess is that the thread is hanging while the file loads from disk.</p>\r\n<p><del>Did the two errors you put in the comments happen at the exact same time as the main error here? Or did they happen separately?</del> Also, does this error happen after the sound has been played once after logging in?</p>\r\n<p>EDIT: Ok, they were all at the same time. Apparently \"script ran too long\" errors let the call stack unwind instead of immediately killing it, so each safecall got to raise its own error. Interesting.</p> <div class=\"project-issue-comment-body-modified\"> <hr> <span class=\"e-infoLabel\">Edited</span><span> <abbr class=\"tip standard-date standard-datetime\" title=\"07 31 2013 04:32:16 (CST) (UTC-5:00)\" data-epoch=\"1375263136\">Jul 31, 2013</abbr></span> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2013-07-31T09:23:06Z"},{"body":" <p>Just investigated. There is indeed a delay the first time that a sound is played in a session. There isn't anything that I can do about it.</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2013-08-02T00:52:48Z"},{"body":" <p><span>:O</span> <span>;)</span></p> <div class=\"project-issue-comment-body-modified\"> <hr> <span class=\"e-infoLabel\">Edited</span><span> <abbr class=\"tip standard-date standard-datetime\" title=\"08 2 2013 06:40:41 (CST) (UTC-5:00)\" data-epoch=\"1375443641\">Aug 2, 2013</abbr></span> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/lsjyzjl\">lsjyzjl</a>","created_at":"2013-08-02T11:40:21Z"},{"body":" <p>I should add - I have actually released something of a fix. I updated TellMeWhen's update engine so that execution will never exceed 30ms (or something around there - maybe I set it to 40?) per frame. This can't stop this error from happening if a single PlaySoundFile() call exceeds the limit, though. It will only stop execution if the limit was reached BEFORE PlaySoundFile() caused the lag. If the limit isn't reached, and then PlaySoundFile() takes 180ms, you will still error. But it is a step in the right direction.</p>\r\n<p>I also implemented a similar system in DogTag to prevent the errors that everybody gets all the time from DogTag and DogTag-Unit. Just awaiting Parnic to review and implement it since access to the DogTag repo was made private after a mishap a while back.</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2013-08-02T21:41:11Z"},{"body":" <p>Marking as fixed since this is as fixed as it can ever be. </p>\r\n<p>P.s. I should have mentioned in my last comment that the execution cap for a single script handler is 200ms before the script ran too long error is triggered.</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2013-08-02T21:42:40Z"},{"body":" <p>Thank you for your hard \"CODE\" work. <span>:D</span></p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/lsjyzjl\">lsjyzjl</a>","created_at":"2013-08-03T11:04:16Z"}]}