{"issue":{"title":"[CF 1481] How to get count of raid units with special low hp? ","body":" <p>I tried use icon type unit conditions and for eah unit set HP value and use use stack visible but its doesn't help. I see only solution to create 40+ icons for each raid number and use counter as notification. Can some one explain me how to get count of buffs/unit hp from multi targets?</p> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Aynni\">Aynni</a> | Imported from CurseForge issue <a href=\"https://wow.curseforge.com/projects/tellmewhen/issues/1481\">#1481</a> | <a href=\"https://github.com/tmw-issue-import/dump/blob/master/html/1481.html\">Raw</a>","closed":true,"closed_at":"2018-06-03T19:00:18Z","created_at":"2018-04-02T12:56:45Z","updated_at":"2018-06-03T19:00:18Z","labels":[]},"comments":[{"body":" <p>You can do this with LUA by rotating all party members and checking their HP, then keep that number on a counter.</p>\r\n<p>&nbsp;</p>\r\n<p>This code (didnt test but it should work baring any LUA syntax errors I might have) will get you the count:</p>\r\n<p>&nbsp;</p>\r\n<div>\n\n```\nlocal low_health_count = 0\r\n\r\nlocal i, unit_name, current, max\r\n\r\nfor i=1,40 do \r\n\tunit_name = GetRaidRosterInfo(index)\r\n\tif (unit_name) then\r\n\t\tcurrent = UnitHealth(unit_name)\r\n\t\tmax = UnitHealthMax(unit_name)\r\n\r\n\t\tif (current / max &lt; 0.3) then\r\n\t\t\tlow_health_count =  low_health_count+1\r\n\t\tend\r\n\tend\r\nend\r\n\n```\n</div>\r\n<p>You can use the code in <a href=\"https://github.com/tmw-issue-import/TellMeWhen/issues?q=%5BCF%201489%5D+in%3Atitle\" rel=\"nofollow\">this issue </a>to update the counter.</p>\r\n<p>&nbsp;</p>\r\n<p>You will also need to decide when/how to poll this data.</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/ariehg\">ariehg</a>","created_at":"2018-05-16T11:28:57Z"},{"body":" <p>(don't know how to put this without sounding like self promotion, but you can <a href=\"https://wow.curseforge.com/projects/tellmewhen_script_tools\" rel=\"nofollow\">use this addon</a> I wrote to have some easier time writing such an icon since it exposes some easier APIs to do this sort of thing with TMW, though you can do it all without it)</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/ariehg\">ariehg</a>","created_at":"2018-05-16T11:31:09Z"},{"body":" <p><a href=\"https://gist.githubusercontent.com/arieh/756285d088ce1905b4b29b4533e50b4c/raw/21cfd0bd43bcd6f37fa502c86a15fb558d0303fe/gistfile1.txt\" rel=\"nofollow\">https://gist.githubusercontent.com/arieh/756285d088ce1905b4b29b4533e50b4c/raw/21cfd0bd43bcd6f37fa502c86a15fb558d0303fe/gistfile1.txt</a></p>\r\n<p>&nbsp;</p>\r\n<p>This will do the trick I think. If you dont use the addon I suggested you can just set the counter like it says in the issue I linked to.</p>\r\n<p>&nbsp;</p>\r\n<p>The important thing for you is it creates a new counter - \"low_health_count\" - which you can use in any of your icons&nbsp;</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/ariehg\">ariehg</a>","created_at":"2018-05-16T11:45:32Z"},{"body":" <p>can also try this one:</p>\r\n<p><a href=\"https://gist.githubusercontent.com/arieh/58294fed09a7e51b6e0eb42902bcf9c7/raw/f1ad8ac0e3b4b5cbc2908368d0704b1a1054ec25/gistfile1.txt\" rel=\"nofollow\">https://gist.githubusercontent.com/arieh/58294fed09a7e51b6e0eb42902bcf9c7/raw/f1ad8ac0e3b4b5cbc2908368d0704b1a1054ec25/gistfile1.txt</a></p>\r\n<p>&nbsp;</p>\r\n<p>which uses the combat log event icon type (which I just learned about :) ), though I might be using it incorrectly</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/ariehg\">ariehg</a>","created_at":"2018-05-16T12:10:12Z"},{"body":" <p>Thanks for answer, this is a lot of new staff for me :)</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Aynni\">Aynni</a>","created_at":"2018-05-17T23:08:08Z"}]}