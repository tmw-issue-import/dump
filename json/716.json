{"issue":{"title":"[CF 716] Condition: talent learned misfiring ","body":" <p>^1^T^SShowTimer^B ^SType^Scooldown ^SConditions^T ^N1^T ^SType^SLUA ^SName^S(CooldownDuration(\"Bloodthirst\")~`-~`CooldownDuration(\"Dragon~`Roar\"))~`&gt;=~`1 ^t^N2^T ^SType^SSPELLRANGE ^SUnit^Starget ^SName^SHamstring ^t^N3^T ^SType^SDEBUFFDUR ^SChecked^B ^SUnit^Starget ^SName^SColossus~`Smash ^t^N4^T ^SType^SBUFFDUR ^SOperator^S~|= ^SName^SBloodbath ^SPrtsBefore^N1 ^t^N5^T ^SType^STALENTLEARNED ^SPrtsAfter^N1 ^SName^SBloodbath ^SLevel^N1 ^SAndOr^SOR ^t^Sn^N5 ^t^SShowTimerText^B ^SClockGCD^B ^SName^SDragon~`Roar ^SEnabled^B ^SShowWhen^N3 ^t^N61101^S~`~| ^Sicon^^</p><p>Since I have Bloodbath specced this icon should only show when I have Bloodbath up. However when I'm on a global it will display anyway. I'm using 679.</p> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/AmeroGer\">AmeroGer</a> | Imported from CurseForge issue <a href=\"https://wow.curseforge.com/projects/tellmewhen/issues/716\">#716</a> | <a href=\"https://github.com/tmw-issue-import/dump/blob/master/html/716.html\">Raw</a>","closed":true,"closed_at":"2013-02-18T03:40:14Z","created_at":"2012-11-29T14:57:05Z","updated_at":"2013-02-18T03:40:14Z","labels":["defect","resolved"]},"comments":[{"body":" <p>I am unable to reproduce this.</p>\r\n<p>Could you give me some screenshots, videos, and/or step-by-step instructions (what spells to cast in what order along with what talents and spec I have to have) that will reproduce this?</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2012-12-11T00:58:42Z"},{"body":" <p>Video: <a href=\"http://www.youtube.com/watch?v=_o8sYLZhZNM\" rel=\"nofollow\">http://www.youtube.com/watch?v=_o8sYLZhZNM</a></p>\r\n<p>Export of the slimmed down version of the icon used in the video:</p>\r\n<p>^1^T^SShowTimer^B ^SType^Scooldown ^SName^SDragon`Roar ^SClockGCD^B ^SShowWhen^N3 ^SConditions^T ^N1^T ^SType^SLUA ^SOperator^S|= ^SName^S(AuraDur(\"player\",`12292,`\"Bloodbath\",`\"HELPFUL\")`&gt;`CooldownDuration(\"gcd\")) ^SPrtsBefore^N1 ^t^N2^T ^SType^STALENTLEARNED ^SPrtsAfter^N1 ^SName^SBloodbath ^SLevel^N1 ^SAndOr^SOR ^t^Sn^N2 ^t^SEnabled^B ^SShowTimerText^B ^t^N61216^S`| ^Sicon^^</p>\r\n<p>Upon review the icon is behaving exactly as it should if I had made a typo (Which I didn't. I must've checked 5 times or something). If I set the slider to true the condition doesn't succeed either. Also the lua condition for the bloodbath buff is irrelevant for the bug.</p> <div class=\"project-issue-comment-body-modified\"> <hr> <span class=\"e-infoLabel\">Edited</span><span> <abbr class=\"tip standard-date standard-datetime\" title=\"12 17 2012 09:01:38 (CST) (UTC-6:00)\" data-epoch=\"1355756498\">Dec 17, 2012</abbr></span> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/AmeroGer\">AmeroGer</a>","created_at":"2012-12-17T14:50:29Z"},{"body":" <p>Figured it out. Fixed in r709.</p>\r\n<p>Fun Time Technical Explanation:</p>\r\n<p>What was happening is that the Talent learned condition relies on a table lookup to see what talents you have learned (its much more efficient than iterating over every single one of your conditions every time the condition set that it is in is updated).</p>\r\n<p>This lookup table and the code that updates it only gets initialized when the condition compiler calls the \"events\" method of the condition (to ask the condition what updates it needs to run in order to stay properly updated). When you have a Lua condition (or any other condition that reports itself as being OnUpdate driven), the condition compiler stops calling the \"events\" method of all subsequent conditions because once you have one OnUpdate driven condition, the entire condition set must be OnUpdate driven, so there is no point in checking the rest of the conditions for their events.</p>\r\n<p>The Talent Learned condition was expecting its \"events\" method to be called every time it is used, but this was not always the case, which is why it wasn't updating.</p>\r\n<p>The solution was both to prevent the condition compiler from prematurely terminating its event querying procedure, and also to move the lookup table initialization code for this (and two others that utilize the same concept) condition to a spot where it will always be executed before it is actually needed.</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2013-02-18T03:40:04Z"}]}