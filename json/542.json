{"issue":{"title":"[CF 542] Condition: Spell Cooldown Forecast ","body":" <p>Alright, so I've been thinking about this a while. As you know I use TellMeWhen to show what button I should be mashing next. Sometimes the condition of those icons is that another spell have a cooldown of at least 1 second remaining. This condition however is only reliable when the spell with the lower priority is ready.</p><p>How about implementing a condition that forecasts what the cooldown of another spell (b) will be once the cooldown of (a) is finished and then evaluates whether that number passes the condition? It would even be fairly easy. Just take the cooldown on (b) and subtract the cooldown on (a).</p><p>Now maybe this feature is too marginal for standalone implementation but maybe it's enough to justifiy a checkbox? Or maybe you could at least explain to me how to do this with a lua condition?</p> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/AmeroGer\">AmeroGer</a> | Imported from CurseForge issue <a href=\"https://wow.curseforge.com/projects/tellmewhen/issues/542\">#542</a> | <a href=\"https://github.com/tmw-issue-import/dump/blob/master/html/542.html\">Raw</a>","closed":true,"closed_at":"2012-09-12T04:20:31Z","created_at":"2012-08-27T23:16:31Z","updated_at":"2012-09-13T23:05:25Z","labels":["enhancement","declined"]},"comments":[{"body":" <p>The condition function for cooldown duration is</p>\r\n<div><div><div>\n\n```\nCooldownDuration(spell)\r\n\n```\n</div></div>\r\n</div><p>where spell is either a \"spell name\" or a spellID (no quotes for IDs)</p>\r\n<p>Subtraction:</p>\r\n<div><div><div>\n\n```\nCooldownDuration(\"chimera shot\") - CooldownDuration(\"kill command\")\r\n\n```\n</div></div>\r\n</div><p>Subtraction w/ comparison:</p>\r\n<div><div><div>\n\n```\n(CooldownDuration(\"chimera shot\") - CooldownDuration(\"kill command\")) &gt;= 5\r\n\n```\n</div></div>\r\n</div> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2012-08-28T21:28:44Z"},{"body":" <p>Thank you. I'll be implementing this tomorrow after the patch hits in Europe. </p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/AmeroGer\">AmeroGer</a>","created_at":"2012-08-28T22:16:21Z"},{"body":" <p>It's working so far but I might have to do more complex conditions. I don't want to bother you with every one of them but at the same time I can't even find a reference to CooldownDuration(spell) on the internet. I can only find GetSpellCooldown and that seems to serve other functions. Can you recommend a place to look this stuff up?</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/AmeroGer\">AmeroGer</a>","created_at":"2012-08-29T18:20:43Z"},{"body":" <p>CooldownDuration is a function defined by TMW, used only in conditions.</p>\r\n<p>All conditions can be found inside TellMeWhen/Components/Core/Conditions/Categories. Many categories will have a few functions defined at the top that help to simplify what they do. These helper functions will written like <code>function Env.CooldownDuration(spell)</code></p>\r\n<p>You can reference <a href=\"http://wowprogramming.com/docs/api_categories\" rel=\"nofollow\">http://wowprogramming.com/docs/api_categories</a> for all of Blizzard's API. Just be aware that functions with multiple return values (such as GetSpellCooldown ) are difficult to handle in conditions, and usually have to be wrapped inside a helper function (like CooldownDuration)</p>\r\n<p>A few other helper functions you might find useful are AuraStacks, AuraCount, AuraDur, and AuraTooltipNumber.</p>\r\n<p>AuraCount returns how many of a buff/debuff are on a target, and isn't used very much at all. AuraDur and AuraStacks are going to be the two you will use the most.</p>\r\n<p>Their syntax is all the same: <code>AuraDur(unit, name, namename, filter)</code></p>\r\n<ul><li>unit - just a regular unit like you would type into the condition (<code>\"player\"</code>, <code>\"target\"</code>, or a player's name if they are in your group). Can only be one unit.\r\n</li><li>name - the name (in quotes) or spellID (no quotes) of the buff/debuff you want to track.\r\n</li><li>namename - must be the name of the buff/debuff you want to track, even if you are tracking it by spellID.\r\n</li><li>filter - <code>\"HELPFUL\"</code> for buffs, <code>\"HARMFUL\"</code> for debuffs, <code>\"HELPFUL PLAYER\"</code> for buffs cast only by you, <code>\"HARMFUL PLAYER\"</code> for debuffs cast only by you.\r\n</li></ul>\r\n<p>So, for example:</p>\r\n<ul><li><code>AuraDur(\"target\", 118253, \"serpent sting\", \"HARMFUL PLAYER\")</code> tracks my serpent sting on the target, but only that specific spellID.\r\n</li><li><code>AuraDur(\"target\", \"serpent sting\", \"serpent sting\", \"HARMFUL PLAYER\")</code> tracks my serpent sting on the target for any spellID of serpent string.</li></ul> <div class=\"project-issue-comment-body-modified\"> <hr> <span class=\"e-infoLabel\">Edited</span><span> <abbr class=\"tip standard-date standard-datetime\" title=\"08 29 2012 19:08:02 (CST) (UTC-5:00)\" data-epoch=\"1346285282\">Aug 29, 2012</abbr></span> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2012-08-29T22:44:06Z"},{"body":" <p>That's some great info that I'll probably going to keep going back to in the future. I have just one remaining question: Is there also a way to figure out the remaining duration on the GCD?</p>\r\n<p>I currently have this:</p>\r\n<div><div><div>\n\n```\n (CooldownDuration(\"Colossus Smash\") - CooldownDuration(\"Slam\")) &gt;= 1\r\n\n```\n</div></div>\r\n</div><p>\r\nand\r\n</p><div><div><div>\n\n```\n (AuraDur(\"target\", 86346, \"Colossus Smash\", \"HARMFUL PLAYER\") - CooldownDuration(\"Slam\")) &gt;=1\r\n\n```\n</div></div>\r\n</div>\r\n<p>However Slam doesn't have an actual cooldown, it's only affected by the GCD. So the second part turns out to always be 0 which defeats the purpose of the whole thing.</p> <div class=\"project-issue-comment-body-modified\"> <hr> <span class=\"e-infoLabel\">Edited</span><span> <abbr class=\"tip standard-date standard-datetime\" title=\"08 31 2012 06:09:54 (CST) (UTC-5:00)\" data-epoch=\"1346411394\">Aug 31, 2012</abbr></span> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/AmeroGer\">AmeroGer</a>","created_at":"2012-08-31T11:09:02Z"},{"body":" <p>GCD is <code>CooldownDuration(\"gcd\")</code> (case sensitive, unlike tracking a normal spell)</p> <div class=\"project-issue-comment-body-modified\"> <hr> <span class=\"e-infoLabel\">Edited</span><span> <abbr class=\"tip standard-date standard-datetime\" title=\"08 31 2012 06:12:01 (CST) (UTC-5:00)\" data-epoch=\"1346411521\">Aug 31, 2012</abbr></span> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2012-08-31T11:10:54Z"},{"body":" <p>(CooldownDuration(\"Colossus Smash\")) &gt;= (AuraDur(\"target\", 86346, \"Colossus Smash\", \"HARMFUL PLAYER\"))</p>\r\n<p>Does this do what I think it does? The icon seems to be working but it's so complicated that I might not be able to tell if it didn't: </p>\r\n<p>^1^T^SShowTimer^B ^SType^Scooldown ^SConditions^T ^N1^T ^SType^SLUA ^SPrtsAfter^N1 ^SOperator^S&gt;= ^SName^S(CooldownDuration(\"Colossus`Smash\")`-`CooldownDuration(\"gcd\"))`&gt;=`1 ^SLevel^N1 ^SPrtsBefore^N2 ^t^N2^T ^SType^SLUA ^SName^S(CooldownDuration(\"Colossus`Smash\"))`&gt;=`(AuraDur(\"target\",`86346,`\"Colossus`Smash\",`\"HARMFUL`PLAYER\")) ^t^N3^T ^SType^SLUA ^SName^S(AuraDur(\"target\",`86346,`\"Colossus`Smash\",`\"HARMFUL`PLAYER\")`-`CooldownDuration(\"gcd\"))`&gt;=1 ^SAndOr^SOR ^SPrtsBefore^N1 ^t^N4^T ^SType^SLUA ^SPrtsAfter^N2 ^SOperator^S&gt;= ^SName^S(CooldownDuration(\"Colossus`Smash\"))`&lt;=`(AuraDur(\"target\",`86346,`\"Colossus`Smash\",`\"HARMFUL`PLAYER\")) ^SLevel^N1 ^t^N5^T ^SType^SLUA ^SName^S(CooldownDuration(\"Mortal`Strike\")`-`CooldownDuration(\"gcd\"))`&gt;=`1 ^t^N6^T ^SType^SRAGE ^SOperator^S&gt;= ^SLevel^N70 ^t^Sn^N6 ^t^SDurationAlpha^N0.25 ^SStackAlpha^N0.25 ^SName^SSlam ^SManaCheck^B ^SSettingsPerView^T ^Sbar^T ^STextLayout^Sbar1 ^t^Sicon^T ^STextLayout^Sicon1 ^t^Sexp^T ^STextLayout^S ^t^t^SShowWhen^N3 ^SFakeHidden^B ^SShowTimerText^B ^SEnabled^B ^t^N60303^S`| ^Sicon^^</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/AmeroGer\">AmeroGer</a>","created_at":"2012-09-01T20:03:51Z"},{"body":" <p>Should succeed whenever your CS cooldown is greater than or equal to your CS debuff duration.</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2012-09-02T01:38:03Z"},{"body":" <p>I keep finding more stuff I'd like to do with cooldown comparisons. I just dusted off my Dk and as it turns out the rotation contains this step:</p>\r\n<p>Only Scourge Strike if Blood Plague is no more than 1 second (this number isn't final) shorter than the second shortest Unholy or Death Rune and Frost Fever is no more than 1 second shorter than the second shortest Frost or Death Rune, if you would Scourge Strike using a Death Rune.</p>\r\n<p>a) how do you check for the remaining duration of a rune?</p>\r\n<p>and b) is there any short and easy way to figure out the second shortest out of a group of cooldowns? The only way that I've been able to come up with using the and/or logic of conditions would be using the tree from combinatorics:</p>\r\n<div><div><div>\n\n```\nDR1 - Blood Plage &lt;= 1\r\nand\r\n((\r\nDR1 &gt;= DR2\r\nand\r\nDR1 &lt;= DR3\r\nand\r\nDR1 &lt;= DR4\r\nand\r\nDR1 &lt;= UR1\r\nand\r\nDR1 &lt;= UR2\r\n)\r\nor\r\n(\r\nDR1 &lt;= DR2\r\nand\r\nDR1 &gt;= DR3\r\nand\r\nDR1 &lt;= DR4\r\nand\r\nDR1 &lt;= UR1\r\nand\r\nDR1 &lt;= UR2\r\n)\r\nor\r\n(\r\nDR1 &lt;= DR2\r\nand\r\nDR1 &lt;= DR3\r\nand\r\nDR1 &gt;= DR4\r\nand\r\nDR1 &lt;= UR1\r\nand\r\nDR1 &lt;= UR2\r\n)\r\nor\r\n(\r\nDR1 &lt;= DR2\r\nand\r\nDR1 &lt;= DR3\r\nand\r\nDR1 &lt;= DR4\r\nand\r\nDR1 &gt;= UR1\r\nand\r\nDR1 &lt;= UR2\r\n)\r\nor\r\n(\r\nDR1 &lt;= DR2\r\nand\r\nDR1 &lt;= DR3\r\nand\r\nDR1 &lt;= DR4\r\nand\r\nDR1 &lt;= UR1\r\nand\r\nDR1 &gt;= UR2\r\n))\r\n\n```\n</div></div>\r\n</div>\r\n<p>This is only the part for when the first Death Rune is the second shortest. I'd have to do the whole thing over for all 6 runes and then take all of that and do it over again for Frost Fever. Then a few more to check if I'd be Scourge Striking off a Death Rune and I'm dealing with well over 300 conditions for one icon.</p> <div class=\"project-issue-comment-body-modified\"> <hr> <span class=\"e-infoLabel\">Edited</span><span> <abbr class=\"tip standard-date standard-datetime\" title=\"09 3 2012 08:21:15 (CST) (UTC-5:00)\" data-epoch=\"1346678475\">Sep 3, 2012</abbr></span> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/AmeroGer\">AmeroGer</a>","created_at":"2012-09-03T13:15:38Z"},{"body":" <p>I think you've finally found the limit of what TMW can do, haha.</p>\r\n<p>The best way to track this would just be to setup debuff icons for BP and FF and compare with your rune cooldowns on the fly as you are playing. Something this complex would be nearly impossible to configure, and would probably require a lot of external code to manage some of the really complex comparisons.</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2012-09-03T23:23:25Z"},{"body":" <p>Well the \"check sub-metas\" function can figure out a second shortest out of a group. Just make two metas and add all 6 runes to both and sort both prioritizing low duration, check sub-metas on the second meta-icon, then whatever icon the second meta is displaying will be the second shortest. All that's left then is a lua function for the duration of a timer on another icon, something like IconDuration(Grp4, Icon116) and voila.</p>\r\n<p>Btw, I have never been able to make sense of the first paragraph in the Check sub-metas tooltip (Checking this box will cause this icon to check all the icons of any meta icons that it might be checking at any level.) The way I understand the word \"checking\" the metaicon is already checking every subicon in any submeta. It's displaying them after all.</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/AmeroGer\">AmeroGer</a>","created_at":"2012-09-04T00:02:32Z"},{"body":" <p>Explaining a concept that is entirely made up is hard, haha. I will see if I can figure out a better way to phrase that.</p>\r\n<p>To check the duration of another icon:</p>\r\n<div><div><div>\n\n```\nmax(TellMeWhen_Group4_Icon116.attributes.duration - (time - TellMeWhen_Group4_Icon116.attributes.start), 0)\r\n\n```\n</div></div>\r\n</div><p>Not exactly pretty, but there is no function wrapped around this anywhere. This is how icon duration is checked everywhere in TMW's code.</p> <div class=\"project-issue-comment-body-modified\"> <hr> <span class=\"e-infoLabel\">Edited</span><span> <abbr class=\"tip standard-date standard-datetime\" title=\"09 3 2012 19:31:11 (CST) (UTC-5:00)\" data-epoch=\"1346718671\">Sep 3, 2012</abbr></span> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2012-09-04T00:30:26Z"},{"body":" <p>Going to close this ticket. You can continue to ask questions here, though. Just trying to clean up the amount of open tickets.</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2012-09-12T04:20:21Z"},{"body":" <p>Could you tell me how to figure out the remaining duration of the spell I'm currently casting?</p>\r\n<p>Also, I've read the new tooltip on Check/Expand sub-metas. While I've been able to gain some insight into what the addon is doing I'm still not sure what the difference is for the user. Does it mean that if I put a normally sorted meta icon into a meta icon that's sorted by low duration and check \"expand sub-metas\" on the latter, the former meta icon, as it now appears in the latter, will also be sorted by low duration?</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/AmeroGer\">AmeroGer</a>","created_at":"2012-09-13T21:54:55Z"},{"body":" <p>Yes, that is one effect of it.</p>\r\n<p>Basically, if you these icons:</p>\r\n<ol><li>SpellCD1\r\n</li><li>SpellCD2\r\n</li><li>SpellCD3\r\n</li><li>Meta1, checking\r\n<ul><li>SpellCD1\r\n</li><li>SpellCD2\r\n</li></ul></li><li>Meta2, checking\r\n<ul><li>Meta1\r\n</li><li>SpellCD3\r\n</li></ul></li></ol>\r\n<p>and all of the SpellCD icons are shown, then:</p>\r\n<ul><li>If Meta1's Check Sub-metas is checked, nothing special will happen or not happen because it isn't checking any meta icons. It will just show SpellCD1.\r\n</li><li>If Meta1's Check Sub-metas is unchecked, nothing special will happen or not happen because it isn't checking any meta icons. It will just show SpellCD1.\r\n</li><li>If Meta2's Check Sub-metas is unchecked, it will just display Meta1 (which in turn causes it to display SpellCD1, since that is what Meta1 is displaying)\r\n<ul><li>This is because it is checking Meta1 directly, so it will just show whatever Meta1 is actually showing, which is SpellCD1\r\n</li></ul></li><li>If Meta2's Check Sub-metas is checked, it will display SpellCD2\r\n<ul><li>This is because it isn't checking Meta1 directly, but is instead replacing Meta1 with all of Meta1's icons. Meta2's icon list, internally, becomes\r\n<ul><li>SpellCD1\r\n</li><li>SpellCD2\r\n</li><li>SpellCD3\r\n</li></ul></li><li>Since SpellCD1 is already being shown by Meta1, Meta2 moves onto the next icon in the list, which is SpellCD2, sees that it is not shown, shows it, and terminates.\r\n</li></ul></li></ul>\r\n<ul><li>If you were to create a Meta3 that checks Meta2 with Check sub-metas enabled, it would display SpellCD3, since SpellCD1 and spellCD2 are already being shown by other meta icons with lower iconIDs than Meta3.\r\n</li></ul>\r\n<ul><li>If you placed Meta3 immediately after SpellCD3 in the group (it would be iconID 4, instead of after Meta2 where it would be iconID 6), then:\r\n<ul><li>Meta3 (iconID 4) would show SpellCD1\r\n</li><li>Meta1 (iconID 5) would show SpellCD1 as well (since Meta1's Check Sub-metas isn't checked, it doesn't care that SpellCD1 has already been shown by Meta3. It just looks directly at SpellCD1 and shows it.)\r\n<ul><li>If Meta1's Check sub-metas is checked, it will display SpellCD2, since that is the next icon in its list that has not yet been shown by another meta icon.\r\n</li></ul></li><li>Meta 2 (iconID 6) would show SpellCD2, since SpellCD1 has already been shown by another meta icon (Meta3) with Check Sub-metas enabled.\r\n<ul><li>If Meta1's Check sub-metas is checked, Meta2 will show SpellCD3, since that is the next icon in the list that has not yet been shown by another meta icon (SpellCD2 has already been taken by Meta1)\r\n</li></ul></li></ul></li></ul>\r\n<p>That's why its so hard to come up with a short and precise description for this setting.</p> <div class=\"project-issue-comment-body-modified\"> <hr> <span class=\"e-infoLabel\">Edited</span><span> <abbr class=\"tip standard-date standard-datetime\" title=\"09 13 2012 17:21:39 (CST) (UTC-5:00)\" data-epoch=\"1347574899\">Sep 13, 2012</abbr></span> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2012-09-13T22:09:52Z"},{"body":" <p>For spell casts:</p>\r\n<p>(Requires r610)</p>\r\n<div><div><div>\n\n```\nUnitCastTime(unit, level, matchname)\r\n\n```\n</div></div>\r\n</div><ul><li>unit - unitID that you want to track\r\n</li><li>level:\r\n<ul><li>0 - only interruptible\r\n</li><li>1 - cast present\r\n</li><li>2 - cast absent (has no practical application here, doesn't even really work actually)\r\n</li></ul></li><li>matchname - MUST be lowercase. Use an empty string (\"\") to match any spell cast name.\r\n</li></ul>\r\n<p>Examples</p>\r\n<div><div><div>\n\n```\n-- Matches a cast named \"Big Spell\"\r\nUnitCastTime(\"player\", 1, \"big spell\")\r\n\r\n-- Matches anything you cast:\r\nUnitCastTime(\"player\", 1, \"\")\r\n\n```\n</div></div>\r\n</div> <div class=\"project-issue-comment-body-modified\"> <hr> <span class=\"e-infoLabel\">Edited</span><span> <abbr class=\"tip standard-date standard-datetime\" title=\"09 13 2012 17:40:51 (CST) (UTC-5:00)\" data-epoch=\"1347576051\">Sep 13, 2012</abbr></span> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2012-09-13T22:40:27Z"},{"body":" <p>You know, this thread contains a lot of really useful information for advanced users. I really think this should be made more visible so I'm not the only person benefiting from this.</p>\r\n<p>For example this ticket: <a href=\"https://github.com/tmw-issue-import/TellMeWhen/issues?q=%5BCF%20506%5D+in%3Atitle\" rel=\"nofollow\">http://wow.curseforge.com/addons/tellmewhen/tickets/506-rotation-helper-addon-built-on-top-of-tmw/</a></p>\r\n<p>In the thread he linked he writes: </p><blockquote><cite>Quote:</cite><p>2. Conditions don't know anything about past actions except for the current state of things. For example when I want to keep 'CS, filler, CS' rotation for my prot pally, I have to set CS icon to show only when it's cooldown is under 1.2 seconds. But if have to perform some bunch of actions and become ready to continue my rotation 1.9 seconds after I casted CS, the CS icon is shown in front already although I have plenty of time to perform another cast.</p>\r\n</blockquote>\r\n<p>The info here could solve his issue.</p> <div class=\"project-issue-comment-body-modified\"> <hr> <span class=\"e-infoLabel\">Edited</span><span> <abbr class=\"tip standard-date standard-datetime\" title=\"09 13 2012 18:05:25 (CST) (UTC-5:00)\" data-epoch=\"1347577525\">Sep 13, 2012</abbr></span> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/AmeroGer\">AmeroGer</a>","created_at":"2012-09-13T23:01:46Z"},{"body":" <p>Well, I did post it in the comments to someone on Curse.com the other day. I should probably put a link to it in the forums (keep discussion in here, though, because I don't get email alerts for the forums.)</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2012-09-13T23:04:34Z"}]}