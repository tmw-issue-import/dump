{"issue":{"title":"[CF 923] Attempted use of thisobj in conditions that don\"t support it. ","body":" <p>I'm getting this error a lot since I updated to 6.2.6-276-gea9fee9:</p>\r\n<div>\n\n```\n10x Components\\Core\\Conditions\\Categories\\Misc.lua:310: Attempted use of thisobj in conditions that don\"t support it.\r\n&lt;in C code&gt;\r\nComponents\\Core\\Conditions\\Categories\\Misc.lua:310: in function &lt;Components\\Core\\Conditions\\Categories\\Misc.lua:299&gt;\r\n(tail call): ?\r\nComponents\\Core\\Conditions\\Conditions.lua:877: in function \"GetConditionCheckFunctionString\"\r\nComponents\\Core\\Conditions\\Conditions.lua:981: in function &lt;Components\\Core\\Conditions\\Conditions.lua:980&gt;\r\nComponents\\Core\\Conditions\\UpdateEngine.lua:173: in function \"GetConditionObject\"\r\nCore\\Conditions\\ConditionObjectConstructor.lua:94: in function \"Construct\"\r\nTellMeWhen-6.2.6-276-gea9fee9\\Components\\Core\\Units\\Units.lua:230: in function &lt;TellMeWhen\\Components\\Core\\Units\\Units.lua:111&gt;\r\n(tail call): ?\r\n&lt;in C code&gt;\r\n&lt;string&gt;:\"safecall Dispatcher[4]\":9: in function &lt;string&gt;:\"safecall Dispatcher[4]\":5\r\n(tail call): ?\r\nTellMeWhen.lua:3114: in function \"Update\"\r\nTellMeWhen\\TellMeWhen-6.2.6-276-gea9fee9.lua:1817: in function \"?\"\r\nlibs\\CallbackHandler-1.0\\CallbackHandler-1.0-6.lua:147: in function &lt;libs\\CallbackHandler-1.0\\CallbackHandler-1.0.lua:147&gt;\r\n&lt;string&gt;:\"safecall Dispatcher[1]\":4: in function &lt;string&gt;:\"safecall Dispatcher[1]\":4\r\n&lt;in C code&gt;\r\n&lt;string&gt;:\"safecall Dispatcher[1]\":13: in function \"?\"\r\nlibs\\CallbackHandler-1.0\\CallbackHandler-1.0-6.lua:92: in function \"Fire\"\r\nlibs\\AceEvent-3.0\\AceEvent-3.0-3.lua:120: in function &lt;libs\\AceEvent-3.0\\AceEvent-3.0.lua:119&gt;\r\n\r\nLocals:\r\nnil\r\n\n```\n</div>\r\n<p>If it helps, I can narrow down whether it relates to a specific icon and post the import string.</p> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/meribold\">meribold</a> | Imported from CurseForge issue <a href=\"https://wow.curseforge.com/projects/tellmewhen/issues/923\">#923</a> | <a href=\"https://github.com/tmw-issue-import/dump/blob/master/html/923.html\">Raw</a>","closed":true,"closed_at":"2014-02-03T23:03:30Z","created_at":"2014-01-29T11:18:58Z","updated_at":"2014-02-03T23:03:30Z","labels":["defect","resolved"]},"comments":[{"body":" <p>Actually working as intended. Unit conditions have no notion of what icon they are being checked for (units themselves don't either), so there is no way to link between the two. </p>\r\n<p>Perhaps a better error message would help. </p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2014-01-29T14:44:39Z"},{"body":" <p>I'm a little lost here. Does that mean I can't get the unit being checked in Lua unit conditions anymore? I'm using this unit condition</p>\r\n<div><div><div>\n\n```\nselect(2, UnitRace(c.Unit)) == 'Human'\r\n\n```\n</div></div>\r\n</div><p>which, I guess, raises the error but also seems to work fine. Changing it to</p>\r\n<div><div><div>\n\n```\nselect(2, UnitRace(thisobj.Unit)) == 'Human'\r\n\n```\n</div></div>\r\n</div><p>prevents the error and the icon continues to work as intended.</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/meribold\">meribold</a>","created_at":"2014-01-29T18:05:10Z"},{"body":" <p>Re-opening so I remember to add better error messages for this.</p>\r\n<p>That first one should work. The second one won't work because thisobj is undefined for unit conditions, and that isn't how unit conditions should work anyway. A condition set is created for each unit that the icon is checking, and that unit is substituted where ever c.Unit is found in the condition.</p>\r\n<p>That second condition with thisobj would, if thisobj were defined as the icon, call UnitRace on the icon's whole Unit setting string (if you icon were checking \"raid1-40\", it would try to call UnitRace(\"raid1-40\")). To get the unit that the icon is currently displaying information for, you would use thisobj.attributes.unit. But, again, that isn't how unit conditions should be used - they should check information about the unit only, independent of whatever the icon is doing, which is what your first string does.</p> <div class=\"project-issue-comment-body-modified\"> <hr> <span class=\"e-infoLabel\">Edited</span><span> <abbr class=\"tip standard-date standard-datetime\" title=\"01 29 2014 12:33:55 (CST) (UTC-6:00)\" data-epoch=\"1391020435\">Jan 29, 2014</abbr></span> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2014-01-29T18:26:57Z"},{"body":" <p>Forget everything I just said (except the part where I said you shouldn't use thisobj for unit conditions - you still shouldn't). Unit conditions do support thisobj, and that error was happening in error. I have fixed it in g4017c37.</p>\r\n<p>Sorry about all the confusion - sometimes I forget about small things like the fact that I did make it so unit conditions can use thisobj when I don't have a chance to look at the code and play with it in-game.</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2014-02-03T04:10:28Z"}]}