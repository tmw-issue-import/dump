{"issue":{"title":"[CF 874] Generate GUID seems to have collisions in random generation ","body":" <p>Importing to the latest version and having multiple meta icons with wrong sub-icons. Turned out (after looking the the SavedVariables) multiple icons in one big icon container (that is hidden) were given the exact same GUID. The meta icon then chooses the icon with the higher ID (already irrelevant due to an icon being choosen, that is not the one I selected in the options).</p> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Uhman\">Uhman</a> | Imported from CurseForge issue <a href=\"https://wow.curseforge.com/projects/tellmewhen/issues/874\">#874</a> | <a href=\"https://github.com/tmw-issue-import/dump/blob/master/html/874.html\">Raw</a>","closed":true,"closed_at":"2013-10-14T23:06:03Z","created_at":"2013-10-13T13:22:38Z","updated_at":"2013-10-14T23:06:03Z","labels":["defect","resolved"]},"comments":[{"body":"<strong>Attachment Added:</strong><a href=\"https://media.forgecdn.net/attachments/76/161/TellMeWhen_-_broken.lua\" target=\"_blank\"> TellMeWhen_-_broken.lua</a><br> <div class=\"attachment-desc\"> <h4 class=\"attachment-title\">TellMeWhen_-_broken.lua</h4> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Uhman\">Uhman</a>","created_at":"2013-10-13T13:22:38Z"},{"body":"<strong>Attachment Added:</strong><a href=\"https://media.forgecdn.net/attachments/76/162/TellMeWhen.lua\" target=\"_blank\"> TellMeWhen.lua</a><br> <div class=\"attachment-desc\"> <h4 class=\"attachment-title\">TellMeWhen.lua</h4> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Uhman\">Uhman</a>","created_at":"2013-10-13T13:22:38Z"},{"body":" <ul><li>What OS are you running WoW on?\r\n</li><li>Do you have a backup of your SV from before the upgrade? If so, could you attach those to the ticket?\r\n</li><li>Also, could you attach your SV after the upgrade? Thanks.</li></ul> <div class=\"project-issue-comment-body-modified\"> <hr> <span class=\"e-infoLabel\">Edited</span><span> <abbr class=\"tip standard-date standard-datetime\" title=\"10 13 2013 19:50:30 (CST) (UTC-5:00)\" data-epoch=\"1381711830\">Oct 13, 2013</abbr></span> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2013-10-13T17:35:19Z"},{"body":" <p><cite>@<a href=\"https://github.com/tmw-issue-import/TellMeWhen/issues?q=%5BCF%20874%5D+in%3Atitle\" rel=\"nofollow\">Cybeloras</a>: <a href=\"https://github.com/tmw-issue-import/TellMeWhen/issues?q=%5BCF%20874%5D+in%3Atitle\" rel=\"nofollow\">Go</a></cite></p>\r\n<p>I'm running Win7 x64. I only tested this on my main (shaman). Out of a set of 40 Icons that were all in the same container, 22 Icons ended up with the exact same GUID (resulting in 11 collisions, each in pairs of 2) and 18 Icons with a real Unique GUID.</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Uhman\">Uhman</a>","created_at":"2013-10-14T12:48:24Z"},{"body":" <p>If you install 6.2.6-169-g3f6d77d, copy your pre-upgrade SV back into your WTF/Account/accountname/SavedVariables folder, and then start up WoW again, does this happen again?</p>\r\n<p>I added some code that will keep track of the GUIDs generated so that duplicates shouldn't happen. At first I was thinking that the issue was in the way that I handle the upgrade process, but this apparently is not the case because everything worked 100% when I just tried it - everything got its own GUID. I also added some code that should prevent other addons from resetting the high-precision timer that TMW uses to generate quite a few bits of the GUID. You may notice that your login might take a few seconds longer if all GUIDs for a specific second have been exhausted (see below for an explanation).</p>\r\n<p>Anatomy of a GUID: </p>\r\n<p>TMW:icon:1IMciUjjtt0V</p>\r\n<ul><li>TMW is always there\r\n</li><li>icon tells what type of data the GUID is for\r\n</li><li>1IMciUj is based on your current system time, in seconds.\r\n</li><li>jtt0, and the first 3 bits of the last character, are based on the high precision timer.\r\n</li><li>the last 3 bits, and anything after that, are random.\r\n</li></ul>\r\n<p>Here is a small sampling of the GUIDs that were generated for you (there are others that are significantly different, as I'm sure you saw - those were generated in different ticks of the high-precision timer) :</p>\r\n<ul><li>[\"GUID\"] = \"TMW:icon:1IMciUjjtt0l\",\r\n</li><li>[\"GUID\"] = \"TMW:icon:1IMciUjjtt0E\",\r\n</li><li>[\"GUID\"] = \"TMW:icon:1IMciUjjtt0k\",\r\n</li><li>[\"GUID\"] = \"TMW:icon:1IMciUjjtt0t\",\r\n</li><li>[\"GUID\"] = \"TMW:icon:1IMciUjjtt0T\",\r\n</li><li>[\"GUID\"] = \"TMW:icon:1IMciUjjtt0F\",\r\n</li></ul>\r\n<p>As you can see, they are all the same except the random bits, which means that the high-precision timer isn't giving us high-precision time. This is normally the point where I would beat my head against he wall for two weeks trying to figure out what the issue is, but in this case, i am 99% sure what it is. One of WoW's CVars is this: <a href=\"http://wowpedia.org/CVar_timingMethod\" rel=\"nofollow\">http://wowpedia.org/CVar_timingMethod</a>. If it is set wrong, it could cause issues. I haven't had a chance to test it yet with the timer that TMW uses for GUID generation since I realized what the issue was when I was showering this morning and now I'm not home, but I do remember in the past I played around with it and it totally broke CPU profiling (which also relies on high-resolution timing).</p>\r\n<p>In-game, run this slash command and tell me what it outputs: /run print(GetCVar(\"timingMethod\"))</p>\r\n<p>If it outputs a 1, then that is what is causing the issue. Normally, it should output a 0. Type '/console timingMethod 0' to set it to 0, but if you have changed it for a good reason in the past, then you might not want to mess with it - I can implement enough fixes in TMW's end of things that the issue should get resolved regardless.</p>\r\n<p>In the mean time, I will look into implementing some code that should recognize if the high-precision timer isn't working as it should and will fall back on random number generation for the bits that it would normally be providing.</p> <div class=\"project-issue-comment-body-modified\"> <hr> <span class=\"e-infoLabel\">Edited</span><span> <abbr class=\"tip standard-date standard-datetime\" title=\"10 14 2013 13:04:45 (CST) (UTC-5:00)\" data-epoch=\"1381773885\">Oct 14, 2013</abbr></span> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2013-10-14T18:03:23Z"},{"body":" <p><cite>@<a href=\"https://github.com/tmw-issue-import/TellMeWhen/issues?q=%5BCF%20874%5D+in%3Atitle\" rel=\"nofollow\">Cybeloras</a>: <a href=\"https://github.com/tmw-issue-import/TellMeWhen/issues?q=%5BCF%20874%5D+in%3Atitle\" rel=\"nofollow\">Go</a></cite>\r\nThe CVar for timingMethod is set to 1 as you predicted... it's possible, that I set this to 1 a while (years) ago when I worked with CPU Profiling, so I could set it to 0.</p>\r\n<p>After trying the current version the icons that bugged out previously were all fine. I haven't checked all chars yet. But 6 collision errors were thrown:</p>\r\n<p>1x TellMeWhen: GUID collision happened! Please report this error to TellMeWhen\"s project page. \"1381784594\" \"0.45999999999913\" 0 1\r\nTellMeWhen\\TellMeWhen-6.2.6-169-g3f6d77d.lua:1802: in function \"generateGUID\"</p>\r\n<p>1x TellMeWhen: GUID collision happened! Please report this error to TellMeWhen\"s project page. \"1381784594\" \"0.44399999999951\" 0 1\r\nTellMeWhen\\TellMeWhen-6.2.6-169-g3f6d77d.lua:1802: in function \"generateGUID\"</p>\r\n<p>26x TellMeWhen: GUID collision happened! Please report this error to TellMeWhen\"s project page. \"1381784593\" \"0.96099999999933\" 0 1\r\nTellMeWhen\\TellMeWhen-6.2.6-169-g3f6d77d.lua:1802: in function \"generateGUID\"</p>\r\n<p>This one came from the recurseReplaceReferences call</p>\r\n<p>4x TellMeWhen: GUID collision happened! Please report this error to TellMeWhen\"s project page. \"1381784593\" \"0.91400000000067\" 0 1\r\nTellMeWhen\\TellMeWhen-6.2.6-169-g3f6d77d.lua:1802: in function \"generateGUID\"</p>\r\n<p>3x TellMeWhen: GUID collision happened! Please report this error to TellMeWhen\"s project page. \"1381784593\" \"0.88300000000163\" 0 1\r\nTellMeWhen\\TellMeWhen-6.2.6-169-g3f6d77d.lua:1802: in function \"generateGUID\"</p>\r\n<p>1x TellMeWhen: GUID collision happened! Please report this error to TellMeWhen\"s project page. \"1381784593\" \"0.86699999999837\" 0 1\r\nTellMeWhen\\TellMeWhen-6.2.6-169-g3f6d77d.lua:1802: in function \"generateGUID\"</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Uhman\">Uhman</a>","created_at":"2013-10-14T21:14:11Z"},{"body":" <p>Ok. Everything should be all good in 6.2.6-172-g994bc40.</p>\r\n<p>I have removed those errors since it is now 100% impossible for GUID generation collision to happen now.</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2013-10-14T23:05:55Z"}]}