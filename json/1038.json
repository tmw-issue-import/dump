{"issue":{"title":"[CF 1038] Auras not Disappearing when Supposed to ","body":" <p>Using <a href=\"http://wow.curseforge.com/addons/tellmewhen/files/1718-7-2-1-15-g7328f89/\" rel=\"nofollow\">http://wow.curseforge.com/addons/tellmewhen/files/1718-7-2-1-15-g7328f89/</a></p><p>Using an aura to track certain CC casts. Sometimes when the CC gets interrupted or cancelled early, the aura fails to disappear.</p><p><a href=\"http://pastebin.com/3c8b002H\" rel=\"nofollow\">http://pastebin.com/3c8b002H</a></p><p>Another issue is that auras seem to be ignoring any 'Instance Type' conditions.</p><p><a href=\"http://pastebin.com/uEQzZtup\" rel=\"nofollow\">http://pastebin.com/uEQzZtup</a></p> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Jalopyy\">Jalopyy</a> | Imported from CurseForge issue <a href=\"https://wow.curseforge.com/projects/tellmewhen/issues/1038\">#1038</a> | <a href=\"https://github.com/tmw-issue-import/dump/blob/master/html/1038.html\">Raw</a>","closed":true,"closed_at":"2014-12-28T21:42:52Z","created_at":"2014-11-25T22:31:03Z","updated_at":"2015-02-07T23:51:46Z","labels":["defect","declined"]},"comments":[{"body":" <p>I'll also note that sometimes when I load into an arena, the group I use to track party member's CC cooldowns doesn't properly sort itself. When I load and exit config via /tmw, it fixes it, though.</p>\r\n<p><a href=\"http://pastebin.com/nPpqjNQE\" rel=\"nofollow\">http://pastebin.com/nPpqjNQE</a></p>\r\n<p>E: And one more thing, the drop down list for conditions -&gt; Zone PvP Type isn't clickable. Won't drop down to anything.</p> <div class=\"project-issue-comment-body-modified\"> <hr> <span class=\"e-infoLabel\">Edited</span><span> <abbr class=\"tip standard-date standard-datetime\" title=\"11 25 2014 21:49:54 (CST) (UTC-6:00)\" data-epoch=\"1416973794\">Nov 25, 2014</abbr></span> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Jalopyy\">Jalopyy</a>","created_at":"2014-11-25T22:53:19Z"},{"body":" <p>Enable Lua errors before reporting bugs.</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2014-11-26T20:28:15Z"},{"body":" <p>Cast icon not going away: Can you reproduce it outside of an arena with yourself as the caster? As it stands, this is way too vague for me to do anything about, and I can't sit around and do hours of arena hoping to reproduce something like this.</p>\r\n<p>Ignoring instance type conditions: Can you come up with a simpler example? The first condition in that icon is an Icon Shown condition but I don't have the icon that it refers to, and you have two other Instance Type conditions on that icon. Can you come up with an icon with a single condition where it doesn't work?</p>\r\n<p>Icons not sorting: Again, \"sometimes\" bugs are pretty difficult for me to fix - I'm not just going to jump into the code and start making changes left and right in hopes of fixing some fleeting issue, so if you can come up with a more reliable way to reproduce it, that would be great.</p>\r\n<p>Zone PvP Type condition: Well, at least this one was straightforward, but in the future, include any Lua errors you're getting with your bug reports - it makes life a whole lot easier when you do.</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2014-11-26T20:54:53Z"},{"body":" <p><a href=\"http://pastebin.com/95W7kzS4\" rel=\"nofollow\">http://pastebin.com/95W7kzS4</a></p>\r\n<p>LUAs for the Zone PvP Type. I'll work on getting ones for the other issues later when I do some skirms.</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Jalopyy\">Jalopyy</a>","created_at":"2014-11-27T00:07:08Z"},{"body":" <p>Regarding the CC casts not disappearing, I'm 90% sure it has something to do with them getting interrupted mid-cast.</p>\r\n<p>Either kicked by a spell or the unit dies while casting.</p>\r\n<p>As far as the party CC group not showing/sorting, dunno anything specific, but probably something to do with loading into an arena. Maybe related to how other instance type conditions aren't working, but nothing conclusive.</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Jalopyy\">Jalopyy</a>","created_at":"2014-12-02T08:33:10Z"},{"body":" <p>I believe the reason the party member CC spells appear out of order is when the order they are configured in the TMW group doesn't match with the order the player zones into the arena. For example, icon for hex is an earlier icon than shockwave or fear, so when the warrior zones in before the shaman, it seems to push back the hex icon to a further place. I'll try to get a screenshot for you later today of this.</p>\r\n<p>As far as CC cast icons not disappear, most predominately it looks like it happens when the spell is interrupted forcefully, just a stun or a death grip, but also sometimes when the spell is reflected. Dunno exactly. Gonna try to make some weird conditional for only if the spell is in progress or something. Will try dueling a friend to see if I can make this happen on myself.</p>\r\n<p>One note about the CC casts, probably a longshot/stupid question, I'm using a kinda buggy semi-updated version of GladiusEx for my arena frames as of now. Is it possible them being buggy makes the TMW aura be buggy due to possibly TMW feeding information directly off of it (or does TMW go directly to the Blizzard API or whatever)?</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Jalopyy\">Jalopyy</a>","created_at":"2014-12-06T02:49:11Z"},{"body":" <p>For what it matters, by adding a bunch of conditionals for cast = present on each arena1-5, I've eliminated the aura staying when the cast wasn't present before. Unsure if this helps you.</p>\r\n<p><a href=\"http://pastebin.com/1L0tRd9h\" rel=\"nofollow\">http://pastebin.com/1L0tRd9h</a></p>\r\n<p>E: Actually this doesn't make the aura show at all. Oh well.</p> <div class=\"project-issue-comment-body-modified\"> <hr> <span class=\"e-infoLabel\">Edited</span><span> <abbr class=\"tip standard-date standard-datetime\" title=\"12 7 2014 02:45:24 (CST) (UTC-6:00)\" data-epoch=\"1417941924\">Dec 7, 2014</abbr></span> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Jalopyy\">Jalopyy</a>","created_at":"2014-12-07T01:38:46Z"},{"body":" <p><a href=\"http://puu.sh/dk9Iz/cec04eca53.jpg\" rel=\"nofollow\">http://puu.sh/dk9Iz/cec04eca53.jpg</a></p>\r\n<p>GladiusEx (which I noted earlier is sorta hackjobbed currently to work in WOD) is showing the priest is casting Clarity of Mind, yet he's obviously not casting it on his player frame. I checked an old pic I hate of this regarding one of the CC casts, and it wasn't showing a cast, though.</p>\r\n<p>Just adding in case this might be relevant.</p>\r\n<p><a href=\"http://puu.sh/dkdiV/d567c4713d.jpg\" rel=\"nofollow\">http://puu.sh/dkdiV/d567c4713d.jpg</a></p>\r\n<p>Another example, but this time was a gripped cast.</p> <div class=\"project-issue-comment-body-modified\"> <hr> <span class=\"e-infoLabel\">Edited</span><span> <abbr class=\"tip standard-date standard-datetime\" title=\"12 6 2014 21:52:41 (CST) (UTC-6:00)\" data-epoch=\"1417924361\">Dec 6, 2014</abbr></span> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Jalopyy\">Jalopyy</a>","created_at":"2014-12-07T02:56:13Z"},{"body":" <p>For the cast issue, it seems like a case of events not being fired when they should be. I just found two events that were missing (UNIT_SPELLCAST_FAILED_QUIET and UNIT_SPELLCAST_SUCCEEDED (don't ask why SUCCEEDED wasn't there, because I have no clue). FAILED_QUIET is probably redundant with FAILED, but I'll keep it anyway.</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2014-12-07T19:48:22Z"},{"body":" <p>The Gladius thing isn't relevant - it wouldn't be interfering with TMW at all.</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2014-12-07T19:49:57Z"},{"body":" <p>Sounds good, look forward to a fix.</p>\r\n<p>If I find anything concrete about the other things, I'll post here.</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Jalopyy\">Jalopyy</a>","created_at":"2014-12-09T00:27:25Z"},{"body":" <p>Issue is still here in <a href=\"http://wow.curseforge.com/addons/tellmewhen/files/1726-7-2-2-3-g279b794/\" rel=\"nofollow\">http://wow.curseforge.com/addons/tellmewhen/files/1726-7-2-2-3-g279b794/</a></p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Jalopyy\">Jalopyy</a>","created_at":"2014-12-13T08:52:31Z"},{"body":" <p>The cast thing should be (bandaid) fixed in 19f6cc5</p> <div class=\"project-issue-comment-body-modified\"> <hr> <span class=\"e-infoLabel\">Edited</span><span> <abbr class=\"tip standard-date standard-datetime\" title=\"12 22 2014 17:33:05 (CST) (UTC-6:00)\" data-epoch=\"1419291185\">Dec 22, 2014</abbr></span> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2014-12-22T23:32:45Z"},{"body":" <p>I'll test it out tomorrow when I do some arena.</p>\r\n<p>In the meantime, though, making a different aura for every CC cast I track with 5 conditions (for A1-5 cast = present) seems to 'fix' the issue, separate from whatever you just pushed.</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Jalopyy\">Jalopyy</a>","created_at":"2014-12-22T23:40:52Z"},{"body":" <p><a href=\"http://wow.curseforge.com/addons/tellmewhen/files/1744-7-2-2-20-g19f6cc5/\" rel=\"nofollow\">http://wow.curseforge.com/addons/tellmewhen/files/1744-7-2-2-20-g19f6cc5/</a></p>\r\n<p>Still seems present. No relevant LUAs from what I can tell.</p>\r\n<p><a href=\"http://pastebin.com/RgJ9HbUm\" rel=\"nofollow\">http://pastebin.com/RgJ9HbUm</a> - This is the one I'm currently using (have several others tracking different CCs)\r\n<a href=\"http://pastebin.com/Uw702HL0\" rel=\"nofollow\">http://pastebin.com/Uw702HL0</a> - The one I used to use, currently has the issue originally stated.</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Jalopyy\">Jalopyy</a>","created_at":"2014-12-23T11:53:20Z"},{"body":" <p>It turns out that if you don't actually test to see if the fixes you write do what they should do, then chances are, they don't. Try 0ffe6dc.</p> <div class=\"project-issue-comment-body-modified\"> <hr> <span class=\"e-infoLabel\">Edited</span><span> <abbr class=\"tip standard-date standard-datetime\" title=\"12 23 2014 14:30:12 (CST) (UTC-6:00)\" data-epoch=\"1419366612\">Dec 23, 2014</abbr></span> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2014-12-23T20:29:47Z"},{"body":" <p><a href=\"http://puu.sh/dGZ6i/c0201a203e.jpg\" rel=\"nofollow\">http://puu.sh/dGZ6i/c0201a203e.jpg</a></p>\r\n<p>Still seems broken.</p>\r\n<p>The LUA error is unrelated, it's for GladiusEx.</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Jalopyy\">Jalopyy</a>","created_at":"2014-12-23T22:40:18Z"},{"body":" <p>I am utterly confused, then. I am 99.99% certain that it is not an issue with TMW. The Spell Cast icon type doesn't do anything weird that isn't handled by TMW's core framework - it reports its data in the same way that all other icon types do. There is no code path where it might return early and not set anything on the icon, thus leaving the old opacity there.</p>\r\n<p>That it is still broken in 0ffe6dc also proves to be that it is not an issue of Blizzard events not firing when they should, because the \"fix\" in that version made it so that whenever a cast was detected, it would switch to auto updates (aka. as often as possible, disregarding any events) whenever a cast is detected, and not switch off of auto updates until a cast is no longer detected.</p>\r\n<p>This leads me to one last conclusion - that Blizzard's UnitCastingInfo() is returning bogus data.</p>\r\n<p>Before I go further, I have a question. When the cast gets interrupted/cancelled, does the timer on the icon keep ticking down to 0? Or does it stop immediately while the icon remains shown?</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2014-12-26T00:54:27Z"},{"body":" <p>The timer continues as if the cast was still going, assuming it was interrupted (like w/a stun or death grip) forcefully. Once it finishes, it stays up regardless of cast being present or not, and doesn't refresh/change if subsequent casts go out that are tracked.</p>\r\n<p>If it's a case where it gets stuck from a reflect, it just stays shown (like the screenshots I've given) and won't refresh based on other spells that are subsequently cast.</p>\r\n<p>It's kind of a moot point at this stage, since like I've said, the auras I've made the have a bunch of cast=present conditions work perfectly, like how it used to be.</p> <div class=\"project-issue-comment-body-modified\"> <hr> <span class=\"e-infoLabel\">Edited</span><span> <abbr class=\"tip standard-date standard-datetime\" title=\"12 26 2014 01:11:40 (CST) (UTC-6:00)\" data-epoch=\"1419577900\">Dec 26, 2014</abbr></span> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Jalopyy\">Jalopyy</a>","created_at":"2014-12-26T07:10:27Z"},{"body":" <p>Could you attach your whole saved variables file with it configured with the broken icons in place? (Be sure to reload before uploading them or they won't be saved). I have a hunch.</p>\r\n<p>Also, attach the modified version of Gladius that you use.</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2014-12-26T19:09:45Z"},{"body":" <p><a href=\"https://www.mediafire.com/?opifut9rkobn2yy\" rel=\"nofollow\">https://www.mediafire.com/?opifut9rkobn2yy</a></p>\r\n<p>I didn't know if you wanted the SavedVar from the account or the specific character, so I just added both. I switched the places of the icons and then exited the game, so it should be properly updated. If not, the icon that I originally the reported the issue as is in Global Group 8, Icon 24.</p>\r\n<p><a href=\"http://www.wowace.com/addons/gladiusex/files/396-v0-33-beta-1-g30bd103/\" rel=\"nofollow\">http://www.wowace.com/addons/gladiusex/files/396-v0-33-beta-1-g30bd103/</a></p>\r\n<p>The GladiusEx version I use.</p>\r\n<p>E: Uploaded a different one because I didn't see you telling me to reload before exiting, so just in case.</p> <div class=\"project-issue-comment-body-modified\"> <hr> <span class=\"e-infoLabel\">Edited</span><span> <abbr class=\"tip standard-date standard-datetime\" title=\"12 26 2014 13:39:00 (CST) (UTC-6:00)\" data-epoch=\"1419622740\">Dec 26, 2014</abbr></span> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Jalopyy\">Jalopyy</a>","created_at":"2014-12-26T19:33:47Z"},{"body":" <p>OK, thanks. I really have no idea what is going on at this point. I wasn't able to figure out anything more from your SVs, so I'm going to mark this ticket as declined again - there's nothing more that I can think of that will help figure out what might be going on.</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2014-12-28T21:42:01Z"},{"body":" <p>Just posting here for future ref. that I was finally able to witness this bug in person, and can confirm its an API bug since the cast bar did not hide on the Blizzard nameplates (no nameplate addons being used) when the cast stopped early.</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2015-02-07T23:51:46Z"}]}