{"issue":{"title":"[CF 970] Interface action failed because of an AddOn ","body":" <p>There seems to be an issue with switching action bars (or shapeshifting for druids/monks/priests which change the action bars) while using the \"activation border\" notification.&nbsp; There also appears to be UIDropDownMenu taint from accessing /tmw.&nbsp; First the \"activation border\" notificatication issue:</p><p>Here is the icon I made in narrowing it down (note: this is the only icon being used to recreate this issue):</p><p>^1^T^SType^Scooldown ^SName^SThrash ^SEnabled^B ^SEvents^T ^N1^T ^SType^SAnimations ^SAnimation^SACTVTNGLOW ^SEvent^SOnShow ^SInfinite^B ^t^Sn^N1 ^t^t^N70206^S~`~| ^Sicon^^</p><p>Here is a picture with nothing else enabled except TellMeWhen 7.0.2 and bugsack/buggrabber (but this occurs with only TellMeWhen 7.0.2 and nothing else).</p><p><a href=\"http://imgur.com/tyEgECi\" rel=\"nofollow\">http://imgur.com/tyEgECi</a></p><p>To reproduce this:<br>Create an icon with the \"activation border\" notification.&nbsp; Get into combat. Change action bars a few times while pressing buttons.&nbsp; At this point it might not be the first action bar change but it will occur shortly after enough abilities/action bar changes.&nbsp; That picture was probably 10 abilities and 4 action bar changes.&nbsp; It seems to occur most when leaving any form/stance and going to normal form:0 (human) form.&nbsp; I am mouse clicking the stances/forms and mouse clicking them to clear the forms.&nbsp; Only after I left combat did I go into the configuation mode to get the single icon export.</p><p>Here is what pops up in buggrabber/bugsack:</p><p>[ADDON_ACTION_BLOCKED] AddOn \"TellMeWhen\" tried to call the protected function \"ActionButton7:Show()\".<br>!BugGrabber-r198-release\\BugGrabber.lua:552: in function &lt;!BugGrabber\\BugGrabber.lua:552&gt;<br>&lt;in C code&gt;<br>FrameXML\\ActionButton.lua:268: in function \"ActionButton_Update\"<br>FrameXML\\ActionButton.lua:249: in function \"ActionButton_UpdateAction\"<br>FrameXML\\ActionBarController.lua:113: in function \"ActionBarController_UpdateAll\"<br>FrameXML\\ActionBarController.lua:53: in function &lt;FrameXML\\ActionBarController.lua:42&gt;<br>&lt;in C code&gt;<br>FrameXML\\ActionButton.lua:103: in function \"ActionBar_PageDown\"<br>&lt;string&gt;:\"*:OnClick\":1: in function &lt;string&gt;:\"*:OnClick\":1</p><p>Locals:<br>nil</p><p>[ADDON_ACTION_BLOCKED] AddOn \"TellMeWhen\" tried to call the protected function \"OverrideActionBarButton5:Show()\".<br>!BugGrabber-r198-release\\BugGrabber.lua:552: in function &lt;!BugGrabber\\BugGrabber.lua:552&gt;<br>&lt;in C code&gt;<br>FrameXML\\ActionButton.lua:268: in function \"ActionButton_Update\"<br>FrameXML\\ActionButton.lua:523: in function \"ActionButton_OnEvent\"<br>FrameXML\\ActionButton.lua:124: in function &lt;FrameXML\\ActionButton.lua:117&gt;</p><p>Locals:<br>nil</p><p>Numerous ones like those just with different action buttons listed, but I don't think you want to see 20 more.&nbsp; I did several hours of searching to figure out why TMW would be causing it when I ran across this thread which got me centered on the \"activation border\" notification (disregard my ignorance if this has nothing to do with the \"activation border\" notification but it got me thinking about it):<br><a href=\"http://us.battle.net/wow/en/forum/topic/7414944627\" rel=\"nofollow\">http://us.battle.net/wow/en/forum/topic/7414944627</a><br>Specifically this part:<br>\"Ok, seems found why it happens: this taint seems spreads through using ActionButton_ShowOverlayGlow and ActionButton_HideOverlayGlow with custom action buttons (through common overlay frames maybe). Many standard functions using common frames and global variables. Workaround only to copy those code parts into separate files, rename functions, global variables and frames. And include those changed into your addon.\"</p><p>The next issue occurs with tainting the UIDropDownMenu system while using the configuarion mode:</p><p>7/16 22:34:10.934&nbsp; Execution tainted by TellMeWhen while reading TellMeWhen_IconEditorMainTypeText - Interface\\FrameXML\\UIDropDownMenu.lua:1018 UIDropDownMenu_SetText()<br>7/16 22:34:10.934&nbsp; &nbsp; &nbsp; Interface\\AddOns\\TellMeWhen\\Options\\TellMeWhen_Options.lua:1690<br>7/16 22:34:10.934&nbsp; &nbsp; &nbsp; xpcall()<br>7/16 22:34:10.934&nbsp; &nbsp; &nbsp; safecall Dispatcher[2]:9<br>7/16 22:34:10.934&nbsp; &nbsp; &nbsp; Interface\\AddOns\\TellMeWhen\\Lib\\LibOO-1.0\\LibOO-1.0.lua:171 callFunc()<br>7/16 22:34:10.934&nbsp; &nbsp; &nbsp; Interface\\AddOns\\TellMeWhen\\Lib\\LibOO-1.0\\LibOO-1.0.lua:661</p><p>Execution tainted by TellMeWhen while reading TellMeWhen_IconEditorConditionsGroupsGroup1IconText - Interface\\FrameXML\\UIDropDownMenu.lua:1018 UIDropDownMenu_SetText()<br>7/16 22:34:10.953&nbsp; &nbsp; &nbsp; Interface\\AddOns\\TellMeWhen\\Options\\TellMeWhen_Options.lua:1690<br>7/16 22:34:10.953&nbsp; &nbsp; &nbsp; xpcall()<br>7/16 22:34:10.953&nbsp; &nbsp; &nbsp; safecall Dispatcher[2]:9<br>7/16 22:34:10.953&nbsp; &nbsp; &nbsp; Interface\\AddOns\\TellMeWhen\\Lib\\LibOO-1.0\\LibOO-1.0.lua:162 callFunc()<br>7/16 22:34:10.953&nbsp; &nbsp; &nbsp; Interface\\AddOns\\TellMeWhen\\Lib\\LibOO-1.0\\LibOO-1.0.lua:661</p><p>To reproduce tainting the UIDropDownMenu just type /tmw and exit.&nbsp; The taint log will show UIDropDownMenu tainted and that ultimately affects the raid frames in combat (missing frames/targeting issues).&nbsp; To remove it I've been doing a /reload after any /tmw change to remove the taint, though I believe there has to be a better system.</p><p>This might be a better system and easy to implement:<br><a href=\"http://www.wowinterface.com/downloads/info22630-NoTaintUIDropDownMenu.html\" rel=\"nofollow\">http://www.wowinterface.com/downloads/info22630-NoTaintUIDropDownMenu.html</a></p> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/John454ss\">John454ss</a> | Imported from CurseForge issue <a href=\"https://wow.curseforge.com/projects/tellmewhen/issues/970\">#970</a> | <a href=\"https://github.com/tmw-issue-import/dump/blob/master/html/970.html\">Raw</a>","closed":true,"closed_at":"2014-07-19T01:21:41Z","created_at":"2014-07-17T04:14:54Z","updated_at":"2014-07-19T01:21:41Z","labels":["defect","resolved"]},"comments":[{"body":" <p>Well, since you wrote up such a nice, detailed ticket, I guess I'll have to do it now, won't I? I haven't wanted to copy Blizzard's activation glow code because Masque requires that code to be called so that it can skin it properly. However, your ticket inspired me to give it yet another look, and I've found a way to make it work, although it is a very contrived and hackey fix and might break in the future if Masque changes anything. Still better than nothing, though.</p>\r\n<p>Dropdowns are a different story. They are actually coded in such a way that allows AddOns to use them without tainting things, but Blizzard must have missed some things because evidently it doesn't work that way all the time. I'll start working on the dropdown replacement, but that is going to take a bit longer.</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2014-07-18T18:40:10Z"},{"body":" <p>Ok, done.</p> <div class=\"project-issue-comment-body-modified\"> </div> \n<br>\n\n> Posted by CurseForge user <a href=\"https://wow.curseforge.com/members/Cybeloras\">Cybeloras</a>","created_at":"2014-07-19T01:21:32Z"}]}